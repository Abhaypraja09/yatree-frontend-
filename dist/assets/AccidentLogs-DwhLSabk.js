const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/excel-BlgKG4ZM.js","assets/vendor-CNt--W90.js"])))=>i.map(i=>d[i]);
import{b as $,i as c,_ as q}from"./index-DvAaQ92-.js";import{b as i,j as e,S as J,H as U,G as X,E as w,T as I,I as G,Q as H,A as C,m as N,M as k,c as Q,ab as K,z as Z,X as z,ac as y}from"./vendor-CNt--W90.js";import{S as ee}from"./SEO-Bv0d6yxm.js";const ne=()=>{const{selectedCompany:r}=$(),[p,R]=i.useState([]),[L,T]=i.useState([]),[W,D]=i.useState([]),[_,b]=i.useState(!0),[A,x]=i.useState(!1),[h,E]=i.useState(""),[P,te]=i.useState(new Date().getMonth()+1),[B,se]=i.useState(new Date().getFullYear()),[a,l]=i.useState({vehicleId:"",driverId:"",date:new Date().toISOString().split("T")[0],amount:"",description:"",location:"",status:"Pending"}),[d,u]=i.useState([]),[j,v]=i.useState(!1);i.useEffect(()=>{r&&(f(),O(),M())},[r,P,B]);const f=async()=>{if(r?._id){b(!0);try{const t=JSON.parse(localStorage.getItem("userInfo")),{data:s}=await c.get(`/api/admin/accident-logs/${r._id}`);R(s||[])}catch(t){console.error("Error fetching logs",t)}finally{b(!1)}}},O=async()=>{if(r?._id)try{const t=JSON.parse(localStorage.getItem("userInfo")),{data:s}=await c.get(`/api/admin/vehicles/${r._id}`);T(s.vehicles||[])}catch(t){console.error("Error fetching vehicles",t)}},M=async()=>{if(r?._id)try{const t=JSON.parse(localStorage.getItem("userInfo")),{data:s}=await c.get(`/api/admin/drivers/${r._id}?usePagination=false`);D(s.drivers||[])}catch(t){console.error("Error fetching drivers",t)}},Y=async t=>{t.preventDefault(),v(!0);try{const s=new FormData;Object.keys(a).forEach(o=>{s.append(o,a[o])}),s.append("companyId",r._id),d.length>0&&d.forEach(o=>{s.append("photos",o)});const m=JSON.parse(localStorage.getItem("userInfo"));await c.post("/api/admin/accident-logs",s,{headers:{"Content-Type":"multipart/form-data"}}),x(!1),S(),f(),alert("Incident log added successfully")}catch(s){alert(s.response?.data?.message||"Error saving log")}finally{v(!1)}},F=async t=>{if(window.confirm("Are you sure you want to delete this log?"))try{const s=JSON.parse(localStorage.getItem("userInfo"));await c.delete(`/api/admin/accident-logs/${t}`),f()}catch(s){console.error(s)}},V=async()=>{if(g.length===0)return alert("No logs to export");const t=await q(()=>import("./excel-BlgKG4ZM.js").then(n=>n.x),__vite__mapDeps([0,1])),s=t.utils.book_new(),m=g.map(n=>({Date:new Date(n.date).toLocaleDateString("en-IN"),Vehicle:n.vehicle?.carNumber||"N/A",Driver:n.driver?.name||"N/A",Location:n.location||"N/A",Amount:n.amount||0,Status:n.status||"Pending",Description:n.description||""})),o=t.utils.json_to_sheet(m);t.utils.book_append_sheet(s,o,"Accident Logs"),t.writeFile(s,`Accident_Logs_${r.name}_${new Date().toLocaleDateString()}.xlsx`)},S=()=>{l({vehicleId:"",driverId:"",date:new Date().toISOString().split("T")[0],amount:"",description:"",location:"",status:"Pending"}),u([])},g=p.filter(t=>t.vehicle?.carNumber?.toLowerCase().includes(h.toLowerCase())||t.driver?.name?.toLowerCase().includes(h.toLowerCase())||t.description?.toLowerCase().includes(h.toLowerCase()));return e.jsxs("div",{className:"container-fluid",style:{paddingBottom:"40px"},children:[e.jsx(ee,{title:"Active Logs - Incidents & Accidents",description:"Track vehicle accidents and incident logs for your fleet."}),e.jsxs("header",{className:"flex-resp",style:{justifyContent:"space-between",flexWrap:"wrap",gap:"20px",padding:"30px 0"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx("div",{style:{width:"clamp(40px, 10vw, 50px)",height:"clamp(40px, 10vw, 50px)",background:"linear-gradient(135deg, white, #f8fafc)",borderRadius:"16px",padding:"8px",display:"flex",justifyContent:"center",alignItems:"center",boxShadow:"0 10px 25px rgba(0,0,0,0.2)"},children:e.jsx(J,{size:28,color:"#f43f5e"})}),e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"4px"},children:[e.jsx("div",{style:{width:"6px",height:"6px",borderRadius:"50%",background:"#f43f5e",boxShadow:"0 0 8px #f43f5e"}}),e.jsx("span",{style:{fontSize:"clamp(9px, 2.5vw, 10px)",fontWeight:"800",color:"rgba(255,255,255,0.5)",letterSpacing:"1px",textTransform:"uppercase"},children:"Safety Management"})]}),e.jsxs("h1",{style:{color:"white",fontSize:"clamp(24px, 5vw, 32px)",fontWeight:"900",margin:0,letterSpacing:"-1px"},children:["Active ",e.jsx("span",{className:"text-gradient-red",children:"Logs"})]})]})]}),e.jsxs("div",{className:"mobile-search-row",style:{display:"flex",gap:"10px",flex:"1",justifyContent:"flex-end",flexWrap:"wrap"},children:[e.jsxs("div",{className:"glass-card",style:{padding:"0",display:"flex",alignItems:"center",width:"100%",maxWidth:"380px",borderRadius:"14px",border:"1px solid rgba(255,255,255,0.08)",flex:"1 1 auto"},children:[e.jsx(U,{size:18,style:{margin:"0 15px",color:"rgba(255,255,255,0.4)",flexShrink:0}}),e.jsx("input",{type:"text",placeholder:"Search by vehicle, driver or details...",value:h,onChange:t=>E(t.target.value),style:{background:"transparent",border:"none",color:"white",height:"52px",width:"100%",outline:"none",fontSize:"14px"}})]}),e.jsxs("button",{className:"btn-secondary",onClick:V,style:{display:"flex",alignItems:"center",gap:"8px",height:"52px",padding:"0 20px",borderRadius:"14px",fontWeight:"800",background:"rgba(255,255,255,0.05)",color:"white",border:"1px solid rgba(255,255,255,0.1)"},children:[e.jsx(X,{size:18})," ",e.jsx("span",{className:"hide-mobile",children:"Export Excel"})]}),e.jsxs("button",{className:"btn-primary glass-card-hover-effect",onClick:()=>x(!0),style:{display:"flex",alignItems:"center",gap:"10px",height:"52px",padding:"0 25px",borderRadius:"14px",fontWeight:"800",background:"linear-gradient(135deg, #f43f5e, #be123c)"},children:[e.jsx(w,{size:20})," ",e.jsx("span",{className:"hide-mobile",children:"Report Incident"}),e.jsx("span",{className:"show-mobile",children:"Add"})]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(240px, 1fr))",gap:"20px",marginBottom:"30px"},children:[e.jsxs("div",{className:"glass-card",style:{padding:"20px",display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx("div",{style:{width:"45px",height:"45px",borderRadius:"12px",background:"rgba(244, 63, 94, 0.1)",color:"#f43f5e",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(I,{size:22})}),e.jsxs("div",{children:[e.jsx("p",{style:{color:"var(--text-muted)",fontSize:"11px",fontWeight:"800",textTransform:"uppercase",margin:0},children:"Total Incidents"}),e.jsx("h3",{style:{color:"white",fontSize:"24px",fontWeight:"900",margin:"4px 0 0"},children:p.length})]})]}),e.jsxs("div",{className:"glass-card",style:{padding:"20px",display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx("div",{style:{width:"45px",height:"45px",borderRadius:"12px",background:"rgba(245, 158, 11, 0.1)",color:"#f59e0b",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(G,{size:22})}),e.jsxs("div",{children:[e.jsx("p",{style:{color:"var(--text-muted)",fontSize:"11px",fontWeight:"800",textTransform:"uppercase",margin:0},children:"Total Loss Estimates"}),e.jsxs("h3",{style:{color:"white",fontSize:"24px",fontWeight:"900",margin:"4px 0 0"},children:["₹",p.reduce((t,s)=>t+(s.amount||0),0).toLocaleString()]})]})]}),e.jsxs("div",{className:"glass-card",style:{padding:"20px",display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx("div",{style:{width:"45px",height:"45px",borderRadius:"12px",background:"rgba(16, 185, 129, 0.1)",color:"#10b981",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(H,{size:22})}),e.jsxs("div",{children:[e.jsx("p",{style:{color:"var(--text-muted)",fontSize:"11px",fontWeight:"800",textTransform:"uppercase",margin:0},children:"Resolved / Closed"}),e.jsx("h3",{style:{color:"white",fontSize:"24px",fontWeight:"900",margin:"4px 0 0"},children:p.filter(t=>t.status==="Closed").length})]})]})]}),_?e.jsx("div",{style:{display:"flex",justifyContent:"center",padding:"100px 0"},children:e.jsx("div",{className:"spinner"})}):e.jsx("div",{className:"glass-card",style:{padding:"0",overflow:"hidden",background:"transparent"},children:e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"separate",borderSpacing:"0 8px",padding:"0 10px"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{textAlign:"left"},children:[e.jsx("th",{style:{padding:"15px 20px",color:"var(--text-muted)",fontSize:"11px",fontWeight:"800",textTransform:"uppercase"},children:"Date & Location"}),e.jsx("th",{style:{padding:"15px 20px",color:"var(--text-muted)",fontSize:"11px",fontWeight:"800",textTransform:"uppercase"},children:"Vehicle & Driver"}),e.jsx("th",{style:{padding:"15px 20px",color:"var(--text-muted)",fontSize:"11px",fontWeight:"800",textTransform:"uppercase"},children:"Description"}),e.jsx("th",{style:{padding:"15px 20px",color:"var(--text-muted)",fontSize:"11px",fontWeight:"800",textTransform:"uppercase"},children:"Loss (Est.)"}),e.jsx("th",{style:{padding:"15px 20px",color:"var(--text-muted)",fontSize:"11px",fontWeight:"800",textTransform:"uppercase"},children:"Status"}),e.jsx("th",{style:{padding:"15px 20px",color:"var(--text-muted)",fontSize:"11px",fontWeight:"800",textTransform:"uppercase",textAlign:"right"},children:"Actions"})]})}),e.jsx("tbody",{children:e.jsx(C,{children:g.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",style:{textAlign:"center",padding:"60px 0",color:"var(--text-muted)"},children:"No logs found matching your criteria."})}):g.map((t,s)=>e.jsxs(N.tr,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:s*.05},style:{background:"rgba(30, 41, 59, 0.4)",borderRadius:"12px"},className:"glass-card-hover-effect",children:[e.jsxs("td",{style:{padding:"20px",borderTopLeftRadius:"12px",borderBottomLeftRadius:"12px"},children:[e.jsx("div",{style:{color:"white",fontWeight:"700",fontSize:"14px"},children:new Date(t.date).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"12px",color:"rgba(244, 63, 94, 0.8)",marginTop:"4px",fontWeight:"600"},children:[e.jsx(k,{size:12})," ",t.location||"Unknown Location"]})]}),e.jsx("td",{style:{padding:"20px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("div",{style:{background:"rgba(255,255,255,0.05)",padding:"8px",borderRadius:"8px"},children:e.jsx(Q,{size:16,color:"#0ea5e9"})}),e.jsxs("div",{children:[e.jsx("div",{style:{color:"white",fontWeight:"800",fontSize:"14px"},children:t.vehicle?.carNumber}),e.jsx("div",{style:{color:"rgba(255,255,255,0.4)",fontSize:"12px",fontWeight:"600"},children:t.driver?.name})]})]})}),e.jsxs("td",{style:{padding:"20px",maxWidth:"300px"},children:[e.jsx("p",{style:{color:"rgba(255,255,255,0.7)",fontSize:"13px",margin:0,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:"2",WebkitBoxOrient:"vertical"},children:t.description}),t.photos?.length>0&&e.jsx("div",{style:{display:"flex",gap:"5px",marginTop:"8px"},children:e.jsxs("span",{style:{fontSize:"10px",background:"rgba(255,255,255,0.1)",padding:"2px 6px",borderRadius:"4px",color:"white",display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(K,{size:10})," ",t.photos.length," Photos"]})})]}),e.jsx("td",{style:{padding:"20px"},children:e.jsxs("div",{style:{color:"#f43f5e",fontWeight:"900",fontSize:"15px"},children:["₹",t.amount?.toLocaleString()||"0"]})}),e.jsx("td",{style:{padding:"20px"},children:e.jsx("span",{style:{padding:"6px 14px",borderRadius:"20px",fontSize:"11px",fontWeight:"800",textTransform:"uppercase",background:t.status==="Pending"?"rgba(245, 158, 11, 0.1)":t.status==="Closed"?"rgba(16, 185, 129, 0.1)":"rgba(56, 189, 248, 0.1)",color:t.status==="Pending"?"#f59e0b":t.status==="Closed"?"#10b981":"#38bdf8",border:`1px solid ${t.status==="Pending"?"rgba(245, 158, 11, 0.2)":t.status==="Closed"?"rgba(16, 185, 129, 0.2)":"rgba(56, 189, 248, 0.2)"}`},children:t.status})}),e.jsx("td",{style:{padding:"20px",textAlign:"right",borderTopRightRadius:"12px",borderBottomRightRadius:"12px"},children:e.jsx("button",{onClick:()=>F(t._id),style:{background:"rgba(244, 63, 94, 0.1)",color:"#f43f5e",border:"1px solid rgba(244, 63, 94, 0.2)",padding:"10px",borderRadius:"10px",cursor:"pointer",transition:"all 0.3s"},className:"glass-card-hover-effect",children:e.jsx(Z,{size:16})})})]},t._id))})})]})})}),e.jsx(C,{children:A&&e.jsx("div",{className:"modal-overlay",style:{backdropFilter:"blur(10px)",zIndex:1100},children:e.jsxs(N.div,{initial:{opacity:0,scale:.9,y:30},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:30},className:"glass-card modal-content",style:{maxWidth:"650px",width:"95%",padding:"0",background:"#0f172a",border:"1px solid rgba(255,255,255,0.1)"},children:[e.jsxs("div",{style:{padding:"25px",borderBottom:"1px solid rgba(255,255,255,0.05)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx(I,{color:"#f43f5e",size:24}),e.jsxs("div",{children:[e.jsx("h2",{style:{color:"white",margin:0,fontSize:"18px",fontWeight:"800"},children:"Report New Incident"}),e.jsx("p",{style:{color:"var(--text-muted)",fontSize:"12px",margin:"4px 0 0"},children:"Provide accurate details for internal investigation."})]})]}),e.jsx("button",{onClick:()=>x(!1),style:{background:"rgba(255,255,255,0.05)",border:"none",color:"white",padding:"8px",borderRadius:"50%",cursor:"pointer"},children:e.jsx(z,{size:20})})]}),e.jsxs("form",{onSubmit:Y,style:{padding:"30px"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px",marginBottom:"20px"},children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Vehicle Involved *"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsxs("select",{className:"input-field",required:!0,value:a.vehicleId,onChange:t=>l({...a,vehicleId:t.target.value}),style:{appearance:"none",background:"rgba(255,255,255,0.03)"},children:[e.jsx("option",{value:"",style:{background:"#0f172a"},children:"Select Vehicle"}),L.map(t=>e.jsxs("option",{value:t._id,style:{background:"#0f172a"},children:[t.carNumber," - ",t.model]},t._id))]}),e.jsx(y,{size:16,style:{position:"absolute",right:"15px",top:"50%",transform:"translateY(-50%)",pointerEvents:"none",opacity:.5}})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Driver Assigned *"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsxs("select",{className:"input-field",required:!0,value:a.driverId,onChange:t=>l({...a,driverId:t.target.value}),style:{appearance:"none",background:"rgba(255,255,255,0.03)"},children:[e.jsx("option",{value:"",style:{background:"#0f172a"},children:"Select Driver"}),W.map(t=>e.jsxs("option",{value:t._id,style:{background:"#0f172a"},children:[t.name," (",t.mobile,")"]},t._id))]}),e.jsx(y,{size:16,style:{position:"absolute",right:"15px",top:"50%",transform:"translateY(-50%)",pointerEvents:"none",opacity:.5}})]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1.5fr",gap:"20px",marginBottom:"20px"},children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Incident Date *"}),e.jsx("input",{type:"date",className:"input-field",required:!0,value:a.date,onChange:t=>l({...a,date:t.target.value}),style:{background:"rgba(255,255,255,0.03)"}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Incident Location *"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx(k,{size:16,style:{position:"absolute",left:"15px",top:"50%",transform:"translateY(-50%)",opacity:.5}}),e.jsx("input",{type:"text",className:"input-field",required:!0,placeholder:"e.g. Near New Delhi Railway Station",value:a.location,onChange:t=>l({...a,location:t.target.value}),style:{paddingLeft:"45px",background:"rgba(255,255,255,0.03)"}})]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px",marginBottom:"20px"},children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Estimated Loss / Cost"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("span",{style:{position:"absolute",left:"15px",top:"50%",transform:"translateY(-50%)",color:"var(--primary)",fontWeight:"800"},children:"₹"}),e.jsx("input",{type:"number",className:"input-field",placeholder:"Repair estimate",value:a.amount,onChange:t=>l({...a,amount:t.target.value}),style:{paddingLeft:"35px",background:"rgba(255,255,255,0.03)"}})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Case Status"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsxs("select",{className:"input-field",value:a.status,onChange:t=>l({...a,status:t.target.value}),style:{appearance:"none",background:"rgba(255,255,255,0.03)"},children:[e.jsx("option",{value:"Pending",style:{background:"#0f172a"},children:"Pending Review"}),e.jsx("option",{value:"Repaired",style:{background:"#0f172a"},children:"Under Repair"}),e.jsx("option",{value:"Insurance Claimed",style:{background:"#0f172a"},children:"Insurance Claimed"}),e.jsx("option",{value:"Closed",style:{background:"#0f172a"},children:"Case Closed"})]}),e.jsx(y,{size:16,style:{position:"absolute",right:"15px",top:"50%",transform:"translateY(-50%)",pointerEvents:"none",opacity:.5}})]})]})]}),e.jsxs("div",{style:{marginBottom:"25px"},children:[e.jsx("label",{className:"input-label",children:"Incident Description / Remarks *"}),e.jsx("textarea",{className:"input-field",required:!0,placeholder:"Briefly explain what happened, damages sustained, and any third-party involvement...",rows:"4",value:a.description,onChange:t=>l({...a,description:t.target.value}),style:{height:"auto",paddingTop:"15px",background:"rgba(255,255,255,0.03)"}})]}),e.jsxs("div",{style:{marginBottom:"30px"},children:[e.jsx("label",{className:"input-label",children:"Evidence / Site Photos"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(130px, 1fr))",gap:"15px"},children:[d.map((t,s)=>e.jsxs("div",{style:{position:"relative",height:"100px",borderRadius:"12px",overflow:"hidden",border:"1px solid rgba(255,255,255,0.1)"},children:[e.jsx("img",{src:URL.createObjectURL(t),alt:"Preview",style:{width:"100%",height:"100%",objectFit:"cover"}}),e.jsx("button",{type:"button",onClick:()=>u(d.filter((m,o)=>o!==s)),style:{position:"absolute",top:"5px",right:"5px",background:"rgba(244, 63, 94, 0.8)",border:"none",color:"white",padding:"4px",borderRadius:"50%",cursor:"pointer"},children:e.jsx(z,{size:12})})]},s)),d.length<5&&e.jsxs("label",{style:{height:"100px",borderRadius:"12px",border:"2px dashed rgba(255,255,255,0.1)",background:"rgba(255,255,255,0.02)",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",cursor:"pointer",transition:"all 0.3s"},className:"glass-card-hover-effect",children:[e.jsx(w,{size:24,style:{opacity:.3}}),e.jsx("span",{style:{fontSize:"10px",color:"var(--text-muted)",fontWeight:"700",marginTop:"5px"},children:"Add Photo"}),e.jsx("input",{type:"file",multiple:!0,accept:"image/*",hidden:!0,onChange:t=>u([...d,...Array.from(t.target.files)])})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:"15px"},children:[e.jsx("button",{type:"button",className:"btn-secondary",style:{flex:1,height:"52px",fontWeight:"800",borderRadius:"14px",background:"rgba(255,255,255,0.05)",color:"white",border:"1px solid rgba(255,255,255,0.1)"},onClick:()=>{x(!1),S()},children:"Discard"}),e.jsx("button",{type:"submit",disabled:j,className:"btn-primary",style:{flex:2,height:"52px",fontWeight:"900",borderRadius:"14px",background:"linear-gradient(135deg, #f43f5e, #be123c)",border:"none",boxShadow:"0 8px 24px rgba(244, 63, 94, 0.3)"},children:j?e.jsx("div",{className:"spinner",style:{width:"20px",height:"20px"}}):"Save Incident Report"})]})]})]})})})]})};export{ne as default};
