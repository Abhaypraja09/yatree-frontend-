import{b as s,j as e,G as T,E as k,p as _,z as M,m as j,Z as E,_ as P,M as b,A as R}from"./vendor-BGTqS4rJ.js";import{u as q,b as $,i as f}from"./index-Er7Oys5t.js";import{S as B}from"./SEO-BFqQ8ztt.js";import{u as m,w as F}from"./excel-D720nv8R.js";const K=()=>{const{user:U}=q(),{selectedCompany:l}=$(),[S,v]=s.useState([]),[w,N]=s.useState([]),[V,z]=s.useState(!0),[A,c]=s.useState(!1),[d,u]=s.useState("list"),[x,I]=s.useState(""),[r,C]=s.useState(new Date().toISOString().split("T")[0]),[g,G]=s.useState("all"),[a,i]=s.useState({name:"",mobile:"",username:"",password:"",salary:0});s.useEffect(()=>{l&&(y(),L())},[l,r]);const y=async()=>{try{const{data:t}=await f.get(`/api/admin/staff/${l._id}`);v(t)}catch(t){console.error("Error fetching staff:",t)}},L=async()=>{try{const{data:t}=await f.get(`/api/admin/staff-attendance/${l._id}`);N(t),z(!1)}catch(t){console.error("Error fetching staff attendance:",t)}},O=()=>{const t=h.map(n=>({Date:n.date,"Staff Name":n.staff?.name||"Unknown",Mobile:n.staff?.mobile||"N/A","Punch In Time":new Date(n.punchIn.time).toLocaleTimeString(),"Punch In Location":n.punchIn.location?.address||"N/A","Punch Out Time":n.punchOut?.time?new Date(n.punchOut.time).toLocaleTimeString():"On Duty","Punch Out Location":n.punchOut?.location?.address||"N/A",Status:n.status||"Present"})),o=m.json_to_sheet(t),p=m.book_new();m.book_append_sheet(p,o,"Staff Attendance"),F(p,`Staff_Attendance_${r}.xlsx`)},W=async t=>{t.preventDefault();try{await f.post("/api/admin/staff",{...a,companyId:l._id}),c(!1),i({name:"",mobile:"",username:"",password:"",salary:0}),y()}catch(o){alert(o.response?.data?.message||"Error adding staff")}},D=S.filter(t=>t.name.toLowerCase().includes(x.toLowerCase())||t.mobile.includes(x)),h=w.filter(t=>{const o=t.date===r,p=g==="all"||t.staff?._id===g;return o&&p});return e.jsxs("div",{className:"container-fluid",style:{padding:"30px"},children:[e.jsx(B,{title:"Staff Management"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"30px"},children:[e.jsxs("div",{children:[e.jsx("h1",{style:{color:"white",fontSize:"28px",fontWeight:"900",margin:0},children:"Staff Management"}),e.jsx("p",{style:{color:"var(--text-muted)",fontSize:"14px"},children:"Manage office staff and monitor attendance"})]}),e.jsxs("div",{style:{display:"flex",gap:"15px"},children:[e.jsxs("div",{style:{background:"rgba(255,255,255,0.05)",borderRadius:"12px",padding:"4px",display:"flex"},children:[e.jsx("button",{onClick:()=>u("list"),style:{padding:"8px 16px",borderRadius:"8px",border:"none",background:d==="list"?"var(--primary)":"transparent",color:"white",fontWeight:"700",fontSize:"13px",cursor:"pointer"},children:"Staff List"}),e.jsx("button",{onClick:()=>u("attendance"),style:{padding:"8px 16px",borderRadius:"8px",border:"none",background:d==="attendance"?"var(--primary)":"transparent",color:"white",fontWeight:"700",fontSize:"13px",cursor:"pointer"},children:"Attendance Logs"})]}),e.jsxs("button",{onClick:()=>c(!0),className:"btn-primary",style:{display:"flex",alignItems:"center",gap:"8px",height:"45px"},children:[e.jsx(T,{size:18})," Add Staff"]})]})]}),e.jsxs("div",{style:{display:"flex",gap:"20px",marginBottom:"30px",flexWrap:"wrap"},children:[e.jsxs("div",{style:{flex:1,minWidth:"300px",position:"relative"},children:[e.jsx("input",{type:"text",placeholder:"Search staff by name or mobile...",value:x,onChange:t=>I(t.target.value),className:"input-field",style:{width:"100%",paddingLeft:"45px",marginBottom:0,height:"50px"}}),e.jsx(k,{size:20,style:{position:"absolute",left:"15px",top:"15px",color:"var(--text-muted)"}})]}),d==="attendance"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{width:"200px",position:"relative"},children:[e.jsx("input",{type:"date",className:"input-field",value:r,onChange:t=>C(t.target.value),style:{width:"100%",marginBottom:0,height:"50px",paddingLeft:"45px"}}),e.jsx(_,{size:20,style:{position:"absolute",left:"15px",top:"15px",color:"var(--primary)"}})]}),e.jsxs("button",{onClick:O,className:"btn-primary",style:{background:"#10b981",display:"flex",alignItems:"center",gap:"8px",height:"50px",padding:"0 20px"},children:[e.jsx(M,{size:18})," Export Excel"]})]})]}),d==="list"?e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"20px"},children:D.map(t=>e.jsxs(j.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"glass-card",style:{padding:"20px",position:"relative"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginBottom:"20px"},children:[e.jsx("div",{style:{width:"50px",height:"50px",borderRadius:"15px",background:"linear-gradient(135deg, #0ea5e9, #6366f1)",display:"flex",justifyContent:"center",alignItems:"center",color:"white",fontSize:"20px",fontWeight:"800"},children:t.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("h3",{style:{margin:0,color:"white",fontSize:"18px"},children:t.name}),e.jsx("p",{style:{margin:0,color:"var(--text-muted)",fontSize:"13px"},children:t.mobile})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"15px"},children:[e.jsxs("div",{style:{background:"rgba(255,255,255,0.03)",padding:"12px",borderRadius:"12px"},children:[e.jsx("p",{style:{fontSize:"10px",color:"var(--text-muted)",margin:"0 0 5px 0",textTransform:"uppercase",fontWeight:"800"},children:"Username"}),e.jsx("p",{style:{margin:0,color:"white",fontWeight:"700",fontSize:"14px"},children:t.username||"Not Set"})]}),e.jsxs("div",{style:{background:"rgba(255,255,255,0.03)",padding:"12px",borderRadius:"12px"},children:[e.jsx("p",{style:{fontSize:"10px",color:"var(--text-muted)",margin:"0 0 5px 0",textTransform:"uppercase",fontWeight:"800"},children:"Monthly Salary"}),e.jsxs("p",{style:{margin:0,color:"#10b981",fontWeight:"900",fontSize:"14px"},children:["₹",t.salary?.toLocaleString()]})]})]})]},t._id))}):e.jsx("div",{className:"glass-card",style:{padding:0,overflow:"hidden"},children:e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",color:"white"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"rgba(255,255,255,0.05)",textAlign:"left"},children:[e.jsx("th",{style:{padding:"15px 20px",fontSize:"12px",textTransform:"uppercase"},children:"Staff Member"}),e.jsx("th",{style:{padding:"15px 20px",fontSize:"12px",textTransform:"uppercase"},children:"Punch In"}),e.jsx("th",{style:{padding:"15px 20px",fontSize:"12px",textTransform:"uppercase"},children:"Punch Out"}),e.jsx("th",{style:{padding:"15px 20px",fontSize:"12px",textTransform:"uppercase"},children:"Location (In)"}),e.jsx("th",{style:{padding:"15px 20px",fontSize:"12px",textTransform:"uppercase"},children:"Location (Out)"})]})}),e.jsx("tbody",{children:h.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:"5",style:{padding:"40px",textAlign:"center",color:"var(--text-muted)"},children:["No attendance records found for ",r]})}):h.map(t=>e.jsxs("tr",{style:{borderBottom:"1px solid rgba(255,255,255,0.03)"},children:[e.jsxs("td",{style:{padding:"15px 20px"},children:[e.jsx("p",{style:{fontWeight:"800",margin:0},children:t.staff?.name}),e.jsx("span",{style:{fontSize:"11px",color:"var(--text-muted)"},children:t.staff?.mobile})]}),e.jsx("td",{style:{padding:"15px 20px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px",color:"#10b981",fontWeight:"800"},children:[e.jsx(E,{size:14}),new Date(t.punchIn.time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})}),e.jsx("td",{style:{padding:"15px 20px"},children:t.punchOut?.time?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px",color:"#f43f5e",fontWeight:"800"},children:[e.jsx(P,{size:14}),new Date(t.punchOut.time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}):e.jsx("span",{style:{color:"var(--text-muted)",fontSize:"11px"},children:"On Duty"})}),e.jsx("td",{style:{padding:"15px 20px"},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px",fontSize:"12px",color:"var(--text-muted)"},children:[e.jsx(b,{size:14}),e.jsx("span",{style:{maxWidth:"150px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.punchIn.location?.address})]}),t.punchIn.location?.latitude&&e.jsx("a",{href:`https://www.google.com/maps?q=${t.punchIn.location.latitude},${t.punchIn.location.longitude}`,target:"_blank",rel:"noopener noreferrer",style:{fontSize:"10px",color:"var(--primary)",fontWeight:"800",textDecoration:"none"},children:"VIEW ON MAP"})]})}),e.jsx("td",{style:{padding:"15px 20px"},children:t.punchOut?.time?e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px",fontSize:"12px",color:"var(--text-muted)"},children:[e.jsx(b,{size:14}),e.jsx("span",{style:{maxWidth:"150px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.punchOut.location?.address})]}),t.punchOut.location?.latitude&&e.jsx("a",{href:`https://www.google.com/maps?q=${t.punchOut.location.latitude},${t.punchOut.location.longitude}`,target:"_blank",rel:"noopener noreferrer",style:{fontSize:"10px",color:"#f43f5e",fontWeight:"800",textDecoration:"none"},children:"VIEW ON MAP"})]}):e.jsx("span",{style:{color:"var(--text-muted)",fontSize:"11px"},children:"--"})})]},t._id))})]})})}),e.jsx(R,{children:A&&e.jsx("div",{className:"modal-overlay",children:e.jsxs(j.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"glass-card modal-content",style:{maxWidth:"450px",background:"#111827",border:"1px solid rgba(255,255,255,0.1)",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.5)"},children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{className:"modal-title",children:"Add New Staff"}),e.jsx("button",{onClick:()=>c(!1),className:"modal-close-btn",children:"×"})]}),e.jsxs("form",{onSubmit:W,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Full Name"}),e.jsx("input",{type:"text",required:!0,className:"input-field",value:a.name,onChange:t=>i({...a,name:t.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Mobile Number"}),e.jsx("input",{type:"text",required:!0,className:"input-field",value:a.mobile,onChange:t=>i({...a,mobile:t.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Username (Login)"}),e.jsx("input",{type:"text",required:!0,className:"input-field",value:a.username,onChange:t=>i({...a,username:t.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Password"}),e.jsx("input",{type:"password",required:!0,className:"input-field",value:a.password,onChange:t=>i({...a,password:t.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Monthly Salary (₹)"}),e.jsx("input",{type:"number",required:!0,className:"input-field",value:a.salary,onChange:t=>i({...a,salary:t.target.value})})]}),e.jsx("button",{type:"submit",className:"btn-primary",style:{width:"100%",height:"50px",fontSize:"16px",fontWeight:"800"},children:"Register Staff Member"})]})]})})})]})};export{K as default};
