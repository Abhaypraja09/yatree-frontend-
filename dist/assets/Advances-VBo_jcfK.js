import{b as r,j as e,I as F,J as _,$ as f,m as o,A as $,X as O,K as M,p as Y,a7 as q,x as G,l as U}from"./vendor-C_ywCXHK.js";import{b as V,i as h}from"./index-BIJFZ0ug.js";import{S as X}from"./SEO-BK4B2ZiL.js";const Z=()=>{const{selectedCompany:i}=V(),[m,R]=r.useState([]),[b,k]=r.useState([]),[W,C]=r.useState([]),[j,v]=r.useState(!0),[y,I]=r.useState(""),[S,H]=r.useState("All"),[p,T]=r.useState(new Date().getMonth()+1),[c,D]=r.useState(new Date().getFullYear()),[L,u]=r.useState(!1),[s,d]=r.useState({driverId:"",amount:"",date:new Date().toISOString().split("T")[0],remark:""}),[w,z]=r.useState(!1),[l,x]=r.useState({type:"",text:""});r.useEffect(()=>{i&&A()},[i,p,c]);const A=async()=>{if(i?._id){v(!0);try{const[t,a,n]=await Promise.all([h.get(`/api/admin/drivers/${i._id}?usePagination=false&isFreelancer=false`),h.get(`/api/admin/advances/${i._id}?month=${p}&year=${c}`),h.get(`/api/admin/salary-summary/${i._id}?month=${p}&year=${c}`)]);C(t.data.drivers||[]),R(Array.isArray(a.data)?a.data:[]),k(Array.isArray(n.data)?n.data:[])}catch(t){console.error("Error fetching data:",t)}finally{v(!1)}}},B=async t=>{t.preventDefault(),z(!0),x({type:"",text:""});try{await h.post("/api/admin/advances",{...s,companyId:i._id}),x({type:"success",text:"Advance recorded successfully!"}),setTimeout(()=>{u(!1),d({driverId:"",amount:"",date:new Date().toISOString().split("T")[0],remark:""}),x({type:"",text:""}),A()},1500)}catch(a){x({type:"error",text:a.response?.data?.message||"Failed to record advance"})}finally{z(!1)}},g=m.filter(t=>{const a=t.driver?.name?.toLowerCase().includes(y.toLowerCase())||t.remark?.toLowerCase().includes(y.toLowerCase()),n=S==="All"||t.status===S;return a&&n}),N=m.reduce((t,a)=>t+(a.amount||0),0),P=m.reduce((t,a)=>t+(a.recoveredAmount||0),0),E=N-P;return e.jsxs("div",{className:"container-fluid",style:{paddingBottom:"60px"},children:[e.jsx(X,{title:"Driver Advances",description:"Manage and track advances given to drivers and their recovery status."}),e.jsxs("header",{style:{paddingBottom:"30px",borderBottom:"1px solid rgba(255,255,255,0.05)",marginBottom:"30px"},children:[e.jsxs("div",{className:"flex-resp",style:{justifyContent:"space-between",alignItems:"flex-start",gap:"20px"},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},children:[e.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",background:"#fbbf24",boxShadow:"0 0 10px #fbbf24"}}),e.jsx("span",{style:{fontSize:"10px",fontWeight:"900",color:"rgba(255,255,255,0.4)",letterSpacing:"1.5px",textTransform:"uppercase"},children:"Financial Transactions"})]}),e.jsxs("h1",{className:"resp-title",children:["Driver ",e.jsx("span",{style:{color:"#fbbf24"},children:"Advances"})]}),e.jsxs("p",{className:"resp-subtitle",style:{marginTop:"8px",maxWidth:"500px"},children:["Track and manage payments issued to ",e.jsx("b",{children:i?.name})," drivers."]})]}),e.jsxs("div",{className:"flex-resp",style:{gap:"12px"},children:[e.jsxs("div",{className:"glass-card",style:{padding:"15px 25px",background:"rgba(251, 191, 36, 0.05)",border:"1px solid rgba(251, 191, 36, 0.1)",display:"flex",flexDirection:"column",minWidth:"140px"},children:[e.jsx("span",{style:{fontSize:"10px",fontWeight:"800",color:"#fbbf24",textTransform:"uppercase"},children:"Total Issued"}),e.jsxs("span",{style:{color:"white",fontSize:"20px",fontWeight:"900"},children:["₹",N.toLocaleString()]})]}),e.jsxs("div",{className:"glass-card",style:{padding:"15px 25px",background:"rgba(99, 102, 241, 0.05)",border:"1px solid rgba(99, 102, 241, 0.1)",display:"flex",flexDirection:"column",minWidth:"140px"},children:[e.jsx("span",{style:{fontSize:"10px",fontWeight:"800",color:"#6366f1",textTransform:"uppercase"},children:"Advance Payment"}),e.jsxs("span",{style:{color:"white",fontSize:"20px",fontWeight:"900"},children:["₹",E.toLocaleString()]})]})]})]}),e.jsxs("div",{className:"flex-resp",style:{marginTop:"40px",gap:"15px"},children:[e.jsxs("div",{style:{position:"relative",flex:"1",minWidth:"min(100%, 300px)"},children:[e.jsx(F,{size:20,style:{position:"absolute",left:"18px",top:"50%",transform:"translateY(-50%)",color:"rgba(255,255,255,0.3)"}}),e.jsx("input",{type:"text",placeholder:"Search drivers or remarks...",value:y,onChange:t=>I(t.target.value),className:"input-field",style:{paddingLeft:"50px",height:"50px",borderRadius:"15px"}})]}),e.jsxs("div",{className:"flex-resp",style:{width:"auto",gap:"10px"},children:[e.jsx("select",{value:p,onChange:t=>T(Number(t.target.value)),className:"input-field",style:{height:"50px",width:"130px",borderRadius:"15px"},children:Array.from({length:12},(t,a)=>e.jsx("option",{value:a+1,style:{background:"#0f172a"},children:new Date(2e3,a).toLocaleString("default",{month:"long"})},a+1))}),e.jsx("select",{value:c,onChange:t=>D(Number(t.target.value)),className:"input-field",style:{height:"50px",width:"110px",borderRadius:"15px"},children:Array.from({length:5},(t,a)=>{const n=new Date().getFullYear()-2+a;return e.jsx("option",{value:n,style:{background:"#0f172a"},children:n},n)})}),"                        ",e.jsxs("button",{onClick:()=>u(!0),className:"btn-primary",style:{height:"50px",padding:"0 20px",borderRadius:"15px",display:"flex",alignItems:"center",gap:"8px",fontSize:"13px",whiteSpace:"nowrap"},children:[e.jsx(_,{size:20})," ",e.jsx("span",{className:"hide-mobile",children:"RECORD ADVANCE"}),e.jsx("span",{className:"show-mobile",children:"RECORD"})]})]})]})]}),e.jsxs("section",{style:{marginBottom:"60px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"25px"},children:[e.jsx("div",{style:{width:"4px",height:"24px",background:"#fbbf24",borderRadius:"2px"}}),e.jsxs("h2",{style:{color:"white",fontSize:"22px",fontWeight:"900",margin:0,letterSpacing:"-0.5px"},children:["Personnel ",e.jsx("span",{style:{color:"#fbbf24"},children:"Salary Ledger"})]}),e.jsx("span",{style:{fontSize:"11px",background:"rgba(255,255,255,0.05)",color:"var(--text-muted)",padding:"4px 12px",borderRadius:"20px",fontWeight:"800",marginLeft:"auto",textTransform:"uppercase",letterSpacing:"1px"},children:"Real-time Duty Calculation"})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(min(100%, 320px), 1fr))",gap:"20px"},children:b.length===0?e.jsxs("div",{style:{gridColumn:"1/-1",padding:"60px",background:"rgba(30, 41, 59, 0.2)",borderRadius:"30px",textAlign:"center",border:"2px dashed rgba(255,255,255,0.05)"},children:[e.jsx(f,{size:40,style:{margin:"0 auto 15px",opacity:.2,color:"var(--text-muted)"}}),e.jsx("p",{style:{color:"var(--text-muted)",margin:0,fontWeight:"600"},children:"No salary data available yet. Attendance records are required for calculation."})]}):b.map((t,a)=>e.jsxs(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:a*.05},className:"glass-card",style:{padding:"30px",background:"linear-gradient(145deg, rgba(30, 41, 59, 0.6), rgba(15, 23, 42, 0.8))",border:"1px solid rgba(255,255,255,0.05)",boxShadow:"0 20px 40px -15px rgba(0,0,0,0.3)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"25px"},children:[e.jsxs("div",{style:{display:"flex",gap:"15px",alignItems:"center"},children:[e.jsx("div",{style:{width:"44px",height:"44px",borderRadius:"12px",background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.08)",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:"900",fontSize:"18px"},children:t.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("h3",{style:{color:"white",fontSize:"18px",fontWeight:"800",margin:0},children:t.name}),e.jsxs("p",{style:{color:"rgba(255,255,255,0.4)",fontSize:"12px",marginTop:"2px",fontWeight:"600"},children:[t.mobile," • ",t.workingDays," Duty Days"]})]})]}),e.jsx("div",{style:{padding:"6px 14px",borderRadius:"20px",background:t.netPayable>=0?"rgba(16, 185, 129, 0.1)":"rgba(244, 63, 94, 0.1)",color:t.netPayable>=0?"#10b981":"#f43f5e",fontSize:"10px",fontWeight:"900",textTransform:"uppercase",border:`1px solid ${t.netPayable>=0?"rgba(16, 185, 129, 0.2)":"rgba(244, 63, 94, 0.2)"}`,letterSpacing:"1px"},children:t.netPayable>=0?"Net Payable":"Extra Advance"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px"},children:[e.jsxs("div",{style:{background:"rgba(255,255,255,0.02)",padding:"18px",borderRadius:"16px",border:"1px solid rgba(255,255,255,0.03)"},children:[e.jsx("span",{style:{fontSize:"10px",color:"var(--text-muted)",fontWeight:"900",textTransform:"uppercase",letterSpacing:"1px"},children:"Earned Salery"}),e.jsxs("div",{style:{color:"white",fontSize:"20px",fontWeight:"900",marginTop:"6px"},children:["₹",t.totalEarned.toLocaleString()]})]}),e.jsxs("div",{style:{background:"rgba(251, 191, 36, 0.04)",padding:"18px",borderRadius:"16px",border:"1px solid rgba(251, 191, 36, 0.1)"},children:[e.jsx("span",{style:{fontSize:"10px",color:"#fbbf24",fontWeight:"900",textTransform:"uppercase",letterSpacing:"1px"},children:"Advance Balance"}),e.jsxs("div",{style:{color:"#fbbf24",fontSize:"20px",fontWeight:"900",marginTop:"6px"},children:["₹",t.pendingAdvance.toLocaleString()]})]})]}),e.jsxs("div",{style:{marginTop:"25px",padding:"20px",borderRadius:"18px",background:t.netPayable>=0?"rgba(14, 165, 233, 0.1)":"rgba(244, 63, 94, 0.12)",border:`1px solid ${t.netPayable>=0?"rgba(14, 165, 233, 0.2)":"rgba(244, 63, 94, 0.25)"}`,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{color:"white",fontWeight:"800",fontSize:"14px",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Dene Wali Salary"}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsxs("span",{style:{color:"white",fontSize:"24px",fontWeight:"1000"},children:["₹",Math.abs(t.netPayable).toLocaleString()]}),e.jsx("p",{style:{margin:0,fontSize:"10px",color:"rgba(255,255,255,0.4)",fontWeight:"700"},children:"Final Settlement"})]})]})]},t.driverId))})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"25px"},children:[e.jsx("div",{style:{width:"4px",height:"24px",background:"rgba(255,255,255,0.1)",borderRadius:"2px"}}),e.jsx("h2",{style:{color:"white",fontSize:"18px",fontWeight:"800",margin:0},children:"Advance Payment History"})]}),e.jsx("div",{className:"glass-card hide-mobile",style:{padding:"0",overflowX:"auto",border:"1px solid rgba(255,255,255,0.05)",background:"transparent"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"separate",borderSpacing:"0 8px",padding:"0 10px",minWidth:"800px"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{textAlign:"left"},children:[e.jsx("th",{style:{padding:"15px 25px",color:"var(--text-muted)",fontSize:"10px",fontWeight:"900",textTransform:"uppercase",letterSpacing:"1px"},children:"Driver"}),e.jsx("th",{style:{padding:"15px 25px",color:"var(--text-muted)",fontSize:"10px",fontWeight:"900",textTransform:"uppercase",letterSpacing:"1px"},children:"Date"}),e.jsx("th",{style:{padding:"15px 25px",color:"var(--text-muted)",fontSize:"10px",fontWeight:"900",textTransform:"uppercase",letterSpacing:"1px"},children:"Amount"}),e.jsx("th",{style:{padding:"15px 25px",color:"var(--text-muted)",fontSize:"10px",fontWeight:"900",textTransform:"uppercase",letterSpacing:"1px"},children:"Recovered"}),e.jsx("th",{style:{padding:"15px 25px",color:"var(--text-muted)",fontSize:"10px",fontWeight:"900",textTransform:"uppercase",letterSpacing:"1px"},children:"Remarks"})]})}),e.jsx("tbody",{children:j?e.jsx("tr",{children:e.jsxs("td",{colSpan:"5",style:{textAlign:"center",padding:"80px 0"},children:[e.jsx("div",{className:"spinner",style:{margin:"0 auto 20px"}}),e.jsx("p",{style:{color:"var(--text-muted)",fontSize:"14px",fontWeight:"600"},children:"LOADING TRANSACTIONS..."})]})}):g.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:"5",style:{textAlign:"center",padding:"120px 0",background:"rgba(30, 41, 59, 0.2)",borderRadius:"30px",border:"2px dashed rgba(255,255,255,0.05)"},children:[e.jsx(f,{size:60,style:{margin:"0 auto 20px",opacity:.1,color:"#fbbf24"}}),e.jsx("h3",{style:{color:"white",fontSize:"20px",fontWeight:"700",margin:0},children:"No Advance Records"}),e.jsx("p",{style:{color:"var(--text-muted)",marginTop:"8px"},children:"Record a new advance to start tracking."})]})}):g.map((t,a)=>e.jsxs(o.tr,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:a*.03},className:"glass-card-hover-effect",style:{background:"rgba(30, 41, 59, 0.4)",borderRadius:"12px"},children:[e.jsx("td",{style:{padding:"20px 25px",borderTopLeftRadius:"12px",borderBottomLeftRadius:"12px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"10px",background:"rgba(251, 191, 36, 0.1)",color:"#fbbf24",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"800"},children:t.driver?.name?.charAt(0)}),e.jsxs("div",{children:[e.jsx("div",{style:{color:"white",fontWeight:"700"},children:t.driver?.name}),e.jsx("div",{style:{fontSize:"11px",color:"var(--text-muted)"},children:t.driver?.mobile})]})]})}),e.jsx("td",{style:{padding:"20px 25px"},children:e.jsx("div",{style:{color:"rgba(255,255,255,0.8)",fontSize:"14px"},children:new Date(t.date).toLocaleDateString("en-IN",{day:"numeric",month:"short",year:"numeric"})})}),e.jsx("td",{style:{padding:"20px 25px"},children:e.jsxs("div",{style:{color:"white",fontWeight:"800"},children:["₹ ",t.amount?.toLocaleString()]})}),e.jsx("td",{style:{padding:"20px 25px"},children:e.jsxs("div",{style:{color:"#10b981",fontWeight:"700"},children:["₹ ",t.recoveredAmount?.toLocaleString()||0]})}),e.jsx("td",{style:{padding:"20px 25px",borderTopRightRadius:"12px",borderBottomRightRadius:"12px"},children:e.jsx("div",{style:{color:"var(--text-muted)",fontSize:"13px",fontStyle:"italic",maxWidth:"200px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.remark||"-"})})]},t._id))})]})}),e.jsx("div",{className:"show-mobile",children:j?e.jsx("div",{style:{display:"flex",justifyContent:"center",padding:"40px"},children:e.jsx("div",{className:"spinner"})}):g.length===0?e.jsx("div",{style:{textAlign:"center",padding:"40px",color:"var(--text-muted)",background:"rgba(255,255,255,0.02)",borderRadius:"16px"},children:e.jsx("p",{children:"No advances found."})}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"15px"},children:g.map(t=>e.jsxs(o.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"glass-card",style:{padding:"16px",background:"rgba(30, 41, 59, 0.4)",borderRadius:"14px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"8px",background:"rgba(251, 191, 36, 0.1)",color:"#fbbf24",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"800",fontSize:"14px"},children:t.driver?.name?.charAt(0)}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"800",color:"white",fontSize:"16px"},children:t.driver?.name}),e.jsx("div",{style:{fontSize:"12px",color:"var(--text-muted)"},children:new Date(t.date).toLocaleDateString("en-IN")})]})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsxs("div",{style:{color:"#fbbf24",fontWeight:"800",fontSize:"16px"},children:["₹",t.amount?.toLocaleString()]}),e.jsx("div",{style:{fontSize:"10px",color:"var(--text-muted)"},children:"Amount"})]})]}),e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px",background:"rgba(0,0,0,0.2)",borderRadius:"10px",marginBottom:"10px"},children:e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"10px",color:"var(--text-muted)",textTransform:"uppercase",fontWeight:"800"},children:"Recovered"}),e.jsxs("div",{style:{color:"#10b981",fontWeight:"700",fontSize:"14px"},children:["₹",t.recoveredAmount?.toLocaleString()||0]})]})}),t.remark&&e.jsxs("div",{style:{fontSize:"12px",color:"var(--text-muted)",fontStyle:"italic"},children:['"',t.remark,'"']})]},t._id))})}),e.jsx($,{children:L&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.85)",backdropFilter:"blur(16px)",zIndex:1050,display:"flex",justifyContent:"center",alignItems:"center",padding:"20px"},children:e.jsxs(o.div,{initial:{y:50,opacity:0},animate:{y:0,opacity:1},exit:{y:50,opacity:0},className:"glass-card",style:{width:"100%",maxWidth:"480px",padding:"40px",border:"1px solid rgba(255,255,255,0.1)",background:"linear-gradient(135deg, #1e293b 0%, #0f172a 100%)",boxShadow:"0 25px 50px -12px rgba(0,0,0,0.5)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"35px"},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{color:"white",fontSize:"24px",margin:0,fontWeight:"900",letterSpacing:"-0.5px"},children:"Record Advance"}),e.jsx("p",{style:{color:"var(--text-muted)",fontSize:"14px",marginTop:"6px"},children:"Issue a new payment advance to a driver."})]}),e.jsx("button",{onClick:()=>u(!1),className:"glass-card-hover-effect",style:{color:"white",background:"rgba(255,255,255,0.05)",borderRadius:"10px",height:"36px",width:"36px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(O,{size:20})})]}),e.jsxs("form",{onSubmit:B,style:{display:"grid",gap:"25px"},children:[e.jsxs("div",{className:"input-field-group",children:[e.jsxs("label",{className:"input-label",style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(M,{size:14})," Select Driver"]}),e.jsxs("select",{className:"input-field",required:!0,value:s.driverId,onChange:t=>d({...s,driverId:t.target.value}),style:{height:"54px"},children:[e.jsx("option",{value:"",style:{background:"#0f172a",color:"white"},children:"Select a driver..."}),W.map(t=>e.jsxs("option",{value:t._id,style:{background:"#0f172a",color:"white"},children:[t.name," (",t.mobile,")"]},t._id))]})]}),e.jsxs("div",{className:"form-grid-2",children:[e.jsxs("div",{className:"input-field-group",children:[e.jsxs("label",{className:"input-label",style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(f,{size:14})," Amount"]}),e.jsx("input",{type:"number",className:"input-field",placeholder:"0",required:!0,value:s.amount,onChange:t=>d({...s,amount:t.target.value}),style:{height:"54px"}})]}),e.jsxs("div",{className:"input-field-group",children:[e.jsxs("label",{className:"input-label",style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(Y,{size:14})," Date"]}),e.jsx("input",{type:"date",className:"input-field",required:!0,value:s.date,onChange:t=>d({...s,date:t.target.value}),style:{height:"54px"}})]})]}),e.jsxs("div",{className:"input-field-group",children:[e.jsxs("label",{className:"input-label",style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(q,{size:14})," Remark / Purpose"]}),e.jsx("textarea",{className:"input-field",placeholder:"Ex: Urgent family need, Fuel advance...",rows:"2",value:s.remark,onChange:t=>d({...s,remark:t.target.value}),style:{resize:"none",paddingTop:"15px"}})]}),l.text&&e.jsxs(o.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},style:{padding:"16px",borderRadius:"12px",fontSize:"14px",fontWeight:"700",display:"flex",alignItems:"center",gap:"10px",background:l.type==="success"?"rgba(16, 185, 129, 0.1)":"rgba(244, 63, 94, 0.1)",color:l.type==="success"?"#10b981":"#f43f5e",border:`1px solid ${l.type==="success"?"rgba(16, 185, 129, 0.2)":"rgba(244, 63, 94, 0.2)"}`},children:[l.type==="success"?e.jsx(G,{size:18}):e.jsx(U,{size:18}),l.text]}),e.jsx("button",{type:"submit",disabled:w,className:"btn-primary",style:{height:"56px",fontSize:"16px",fontWeight:"900",letterSpacing:"1px",textTransform:"uppercase"},children:w?"RECORDING...":"CONFIRM ADVANCE"})]})]})})})]})};export{Z as default};
