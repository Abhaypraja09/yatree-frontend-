import{b as r,j as e,a9 as z,O as H,C as N,K as V,m as W,aa as M,J as G,p as P,A as $,X as J,ab as U,E as X,l as Y}from"./vendor-BXfTzn-0.js";import{b as q,i as B}from"./index-CTxDrFbq.js";import{S as K}from"./SEO-GJK5pBVT.js";import{a as b}from"./xlsx.min-CEIpZxOS.js";import"./excel-CRHyTskB.js";const re=()=>{const{selectedCompany:c}=q(),[p,T]=r.useState([]),[I,S]=r.useState(!0),[x,R]=r.useState(""),[A,E]=r.useState([]),[o,Z]=r.useState("All"),[_,g]=r.useState(!1),[h,j]=r.useState(null),[n,m]=r.useState({amount:"",method:"",remarks:""}),[u,w]=r.useState(!1),[l,f]=r.useState({type:"",text:""});r.useEffect(()=>{c&&C()},[c]);const C=async()=>{if(c?._id){S(!0);try{const t=JSON.parse(localStorage.getItem("userInfo")),{data:a}=await B.get(`/api/admin/vehicles/${c._id}?usePagination=false&type=all`,{headers:{Authorization:`Bearer ${t.token}`}}),i=(a.vehicles||[]).filter(s=>s.isOutsideCar!==!0).map(s=>({...s,displayCarNumber:s.carNumber?s.carNumber.split("#")[0]:"Unknown"}));T(i);const O=i.flatMap(s=>(s.fastagHistory||[]).map(y=>({...y,carNumber:s.displayCarNumber,vehicleId:s._id,dateObj:new Date(y.date)}))).sort((s,y)=>y.dateObj-s.dateObj);E(O)}catch(t){console.error(t)}finally{S(!1)}}},F=async t=>{t.preventDefault(),w(!0),f({type:"",text:""});try{const a=JSON.parse(localStorage.getItem("userInfo"));await B.post(`/api/admin/vehicles/${h._id}/fastag-recharge`,n,{headers:{Authorization:`Bearer ${a.token}`}}),f({type:"success",text:"Top-up successful!"}),setTimeout(()=>{g(!1),m({amount:"",method:"",remarks:""}),f({type:"",text:""}),C()},1e3)}catch(a){f({type:"error",text:a.response?.data?.message||"Failed to recharge"})}finally{w(!1)}},L=()=>{const t=v.map(i=>({Date:new Date(i.date).toLocaleDateString("en-GB"),Time:new Date(i.date).toLocaleTimeString("en-GB"),Vehicle:i.carNumber,Amount:i.amount,Method:i.method,Remarks:i.remarks})),a=b.utils.json_to_sheet(t),d=b.utils.book_new();b.utils.book_append_sheet(d,a,"Fastag History"),b.writeFile(d,`Fastag_History_${new Date().toISOString().split("T")[0]}.xlsx`)},k=p.filter(t=>(o==="All"||t.displayCarNumber===o)&&(t.displayCarNumber.toLowerCase().includes(x.toLowerCase())||t.fastagNumber?.toLowerCase().includes(x.toLowerCase()))),v=A.filter(t=>(o==="All"||t.carNumber===o)&&t.carNumber.toLowerCase().includes(x.toLowerCase())),D=p.reduce((t,a)=>t+(a.fastagBalance||0),0);return e.jsxs("div",{className:"container-fluid",style:{paddingBottom:"80px"},children:[e.jsx(K,{title:"Fastag Manager",description:"Effectively manage fleet Fastag balances and history."}),e.jsxs("header",{className:"flex-resp",style:{padding:"clamp(20px, 3vh, 30px) 0",borderBottom:"1px solid rgba(255,255,255,0.05)",marginBottom:"30px",justifyContent:"space-between",alignItems:"center",gap:"20px"},children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"resp-title",style:{margin:0,fontWeight:"900",letterSpacing:"-1px",display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("div",{style:{background:"linear-gradient(135deg, #3b82f6, #2563eb)",padding:"10px",borderRadius:"14px",boxShadow:"0 8px 20px rgba(37, 99, 235, 0.4)"},children:e.jsx(z,{size:24,color:"white",fill:"white"})}),"Fastag Manager"]}),e.jsx("p",{className:"resp-subtitle",style:{marginTop:"8px",color:"var(--text-muted)"},children:"Track balances & recharge company vehicles"})]}),e.jsxs("div",{className:"flex-resp",style:{gap:"15px"},children:[e.jsx("div",{className:"glass-card",style:{padding:"12px 20px",display:"flex",alignItems:"center",gap:"15px",background:"rgba(16, 185, 129, 0.1)",border:"1px solid rgba(16, 185, 129, 0.2)"},children:e.jsxs("div",{children:[e.jsx("p",{style:{fontSize:"10px",color:"#10b981",fontWeight:"800",textTransform:"uppercase",marginBottom:"2px"},children:"Wallet Total"}),e.jsxs("h2",{style:{fontSize:"20px",fontWeight:"900",color:"white",margin:0},children:["₹ ",D.toLocaleString()]})]})}),e.jsxs("button",{onClick:()=>{j(null),g(!0)},className:"btn-primary",style:{display:"flex",alignItems:"center",gap:"10px",padding:"14px 24px",fontSize:"14px",borderRadius:"14px",background:"linear-gradient(135deg, #f59e0b, #d97706)",boxShadow:"0 8px 25px rgba(245, 158, 11, 0.4)"},children:[e.jsx(H,{size:20,strokeWidth:3})," NEW RECHARGE"]})]})]}),e.jsxs("div",{style:{marginBottom:"40px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsxs("h3",{style:{fontSize:"16px",fontWeight:"800",color:"white",margin:0,display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(N,{size:18,color:"var(--primary)"})," Company Fleet Balances"]}),e.jsxs("div",{style:{position:"relative",width:"250px"},children:[e.jsx(V,{size:16,style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"var(--text-muted)"}}),e.jsx("input",{type:"text",placeholder:"Find vehicle...",value:x,onChange:t=>R(t.target.value),className:"input-field",style:{paddingLeft:"38px",marginBottom:0,height:"40px",fontSize:"13px",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.05)",borderRadius:"10px"}})]})]}),e.jsx("div",{className:"grid-1-2-3-4",style:{gap:"15px"},children:k.length===0?e.jsx("div",{className:"glass-card",style:{gridColumn:"1/-1",textAlign:"center",padding:"30px",color:"var(--text-muted)"},children:"No active company vehicles found."}):k.map(t=>e.jsxs(W.div,{whileHover:{y:-5},className:"glass-card",style:{padding:"20px",borderLeft:`4px solid ${(t.fastagBalance||0)<500?"#f43f5e":"#10b981"}`,background:"linear-gradient(145deg, rgba(255,255,255,0.03) 0%, rgba(255,255,255,0.01) 100%)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"15px"},children:[e.jsx("h4",{style:{margin:0,fontSize:"18px",fontWeight:"800",color:"white"},children:t.displayCarNumber}),e.jsx("span",{style:{fontSize:"10px",fontWeight:"800",padding:"4px 8px",borderRadius:"6px",background:(t.fastagBalance||0)<500?"rgba(244, 63, 94, 0.1)":"rgba(16, 185, 129, 0.1)",color:(t.fastagBalance||0)<500?"#f43f5e":"#10b981"},children:(t.fastagBalance||0)<500?"LOW":"ACTIVE"})]}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("p",{style:{fontSize:"11px",color:"var(--text-muted)",fontWeight:"700",textTransform:"uppercase",marginBottom:"4px"},children:"Current Balance"}),e.jsxs("p",{style:{fontSize:"24px",fontWeight:"900",color:"white",margin:0},children:["₹ ",t.fastagBalance||0]})]}),e.jsxs("button",{onClick:()=>{j(t),g(!0)},style:{width:"100%",padding:"10px",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.05)",color:"white",fontSize:"11px",fontWeight:"800",borderRadius:"8px",cursor:"pointer",transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},onMouseOver:a=>a.currentTarget.style.background="rgba(255,255,255,0.1)",onMouseOut:a=>a.currentTarget.style.background="rgba(255,255,255,0.05)",children:[e.jsx(z,{size:14})," RECHARGE"]})]},t._id))})]}),e.jsxs("div",{className:"glass-card",style:{padding:"0",overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"25px",borderBottom:"1px solid rgba(255,255,255,0.05)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("h3",{style:{fontSize:"16px",fontWeight:"800",color:"white",margin:0,display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(M,{size:18,color:"#f59e0b"})," Transaction History"]}),e.jsxs("button",{onClick:L,className:"btn-secondary",style:{display:"flex",alignItems:"center",gap:"8px",fontSize:"11px",fontWeight:"800",padding:"8px 16px",background:"rgba(255,255,255,0.05)",color:"white",border:"1px solid rgba(255,255,255,0.05)",borderRadius:"8px"},children:[e.jsx(G,{size:14})," EXPORT EXCEL"]})]}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table",style:{margin:0,width:"100%"},children:[e.jsx("thead",{style:{background:"rgba(0,0,0,0.2)"},children:e.jsxs("tr",{children:[e.jsx("th",{style:{padding:"20px",textAlign:"left",fontSize:"11px",color:"var(--text-muted)",textTransform:"uppercase",fontWeight:"800",letterSpacing:"0.5px"},children:"Date & Time"}),e.jsx("th",{style:{padding:"20px",textAlign:"left",fontSize:"11px",color:"var(--text-muted)",textTransform:"uppercase",fontWeight:"800",letterSpacing:"0.5px"},children:"Vehicle"}),e.jsx("th",{style:{padding:"20px",textAlign:"left",fontSize:"11px",color:"var(--text-muted)",textTransform:"uppercase",fontWeight:"800",letterSpacing:"0.5px"},children:"Amount"}),e.jsx("th",{style:{padding:"20px",textAlign:"left",fontSize:"11px",color:"var(--text-muted)",textTransform:"uppercase",fontWeight:"800",letterSpacing:"0.5px"},children:"Method"}),e.jsx("th",{style:{padding:"20px",textAlign:"left",fontSize:"11px",color:"var(--text-muted)",textTransform:"uppercase",fontWeight:"800",letterSpacing:"0.5px"},children:"Remarks"})]})}),e.jsx("tbody",{children:I?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",style:{textAlign:"center",padding:"50px",color:"var(--text-muted)"},children:"Loading records..."})}):v.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",style:{textAlign:"center",padding:"50px",color:"var(--text-muted)"},children:"No recharge history found."})}):v.map((t,a)=>e.jsxs("tr",{className:"hover-row",style:{borderBottom:"1px solid rgba(255,255,255,0.03)",transition:"background 0.2s"},children:[e.jsx("td",{style:{padding:"18px 20px",color:"white",fontSize:"13px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("div",{style:{padding:"6px",background:"rgba(255,255,255,0.05)",borderRadius:"6px"},children:e.jsx(P,{size:14,color:"var(--primary)"})}),e.jsxs("div",{children:[e.jsx("span",{style:{fontWeight:"700",display:"block"},children:new Date(t.date).toLocaleDateString("en-GB")}),e.jsx("span",{style:{fontSize:"11px",color:"var(--text-muted)"},children:new Date(t.date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]})}),e.jsx("td",{style:{padding:"18px 20px",fontWeight:"700",color:"white",fontSize:"14px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(N,{size:14,color:"var(--text-muted)"}),t.carNumber]})}),e.jsxs("td",{style:{padding:"18px 20px",fontWeight:"800",color:"#10b981",fontSize:"15px"},children:["+₹ ",t.amount]}),e.jsx("td",{style:{padding:"18px 20px",fontSize:"13px",color:"var(--text-muted)"},children:e.jsx("span",{style:{background:"rgba(255,255,255,0.05)",padding:"5px 10px",borderRadius:"6px",fontWeight:"600"},children:t.method})}),e.jsx("td",{style:{padding:"18px 20px",fontSize:"13px",color:"rgba(255,255,255,0.7)"},children:t.remarks||"-"})]},a))})]})})]}),e.jsx($,{children:_&&e.jsx("div",{className:"modal-overlay",style:{display:"flex",alignItems:"center",justifyContent:"center",position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"rgba(0,0,0,0.8)",zIndex:1e3,backdropFilter:"blur(8px)"},children:e.jsxs(W.div,{initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:20},className:"glass-card",style:{width:"90%",maxWidth:"450px",padding:"0",overflow:"hidden",border:"1px solid rgba(255,255,255,0.1)",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.5)"},children:[e.jsx("div",{style:{padding:"30px",background:"linear-gradient(135deg, var(--primary), #2563eb)"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{color:"white",fontSize:"22px",fontWeight:"900",margin:0},children:"Top Up Funds"}),e.jsx("p",{style:{color:"rgba(255,255,255,0.8)",fontSize:"13px",margin:"6px 0 0 0"},children:"Recharge Fastag instantly"})]}),e.jsx("button",{onClick:()=>g(!1),style:{background:"rgba(0,0,0,0.2)",color:"white",border:"none",borderRadius:"50%",width:"36px",height:"36px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"background 0.2s"},children:e.jsx(J,{size:18})})]})}),e.jsx("div",{style:{padding:"30px"},children:e.jsxs("form",{onSubmit:F,style:{display:"grid",gap:"25px"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"11px",fontWeight:"800",color:"var(--text-muted)",textTransform:"uppercase",display:"block",marginBottom:"8px"},children:"Select Vehicle"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsxs("select",{className:"input-field",value:h?._id||"",onChange:t=>{const a=p.find(d=>d._id===t.target.value);j(a)},style:{height:"50px",fontWeight:"700",paddingRight:"40px",cursor:"pointer",appearance:"none",background:"rgba(255,255,255,0.05)"},required:!0,children:[e.jsx("option",{value:"",disabled:!0,style:{color:"#000"},children:"-- Select Vehicle --"}),p.filter(t=>o==="All"||!h?!0:t._id===h._id).map(t=>e.jsxs("option",{value:t._id,style:{color:"#000"},children:[t.displayCarNumber," (Bal: ₹",t.fastagBalance,")"]},t._id))]}),e.jsx(U,{size:16,style:{position:"absolute",right:"15px",top:"50%",transform:"translateY(-50%)",pointerEvents:"none",color:"var(--text-muted)"}})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"11px",fontWeight:"800",color:"var(--text-muted)",textTransform:"uppercase",display:"block",marginBottom:"8px"},children:"Recharge Amount (₹)"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("span",{style:{position:"absolute",left:"15px",top:"50%",transform:"translateY(-50%)",fontSize:"18px",fontWeight:"600",color:"var(--text-muted)"},children:"₹"}),e.jsx("input",{type:"number",className:"input-field",placeholder:"0.00",required:!0,autoFocus:!0,value:n.amount,onChange:t=>m({...n,amount:t.target.value}),style:{height:"50px",fontSize:"20px",fontWeight:"800",paddingLeft:"35px",background:"rgba(255,255,255,0.05)"}})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"11px",fontWeight:"800",color:"var(--text-muted)",textTransform:"uppercase",display:"block",marginBottom:"8px"},children:"Payment Method"}),e.jsx("input",{type:"text",className:"input-field",placeholder:"e.g. UPI, NetBanking, Card",value:n.method,onChange:t=>m({...n,method:t.target.value}),style:{height:"50px",fontWeight:"600",background:"rgba(255,255,255,0.05)"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{fontSize:"11px",fontWeight:"800",color:"var(--text-muted)",textTransform:"uppercase",display:"block",marginBottom:"8px"},children:"Remarks (Optional)"}),e.jsx("textarea",{className:"input-field",placeholder:"Transaction ID, notes, etc.",rows:"2",value:n.remarks,onChange:t=>m({...n,remarks:t.target.value}),style:{resize:"none",background:"rgba(255,255,255,0.05)"}})]}),l.text&&e.jsxs("div",{style:{padding:"12px",borderRadius:"10px",fontSize:"13px",fontWeight:"700",background:l.type==="success"?"rgba(16, 185, 129, 0.1)":"rgba(244, 63, 94, 0.1)",color:l.type==="success"?"#10b981":"#f43f5e",display:"flex",alignItems:"center",gap:"10px",border:l.type==="success"?"1px solid rgba(16, 185, 129, 0.2)":"1px solid rgba(244, 63, 94, 0.2)"},children:[l.type==="success"?e.jsx(X,{size:16}):e.jsx(Y,{size:16}),l.text]}),e.jsx("button",{type:"submit",disabled:u,className:"btn-primary",style:{height:"54px",marginTop:"10px",width:"100%",fontSize:"15px",letterSpacing:"0.5px",background:u?"var(--text-muted)":"linear-gradient(135deg, var(--primary), #2563eb)",boxShadow:u?"none":"0 8px 20px rgba(37, 99, 235, 0.3)"},children:u?"PROCESSING RECHARGE...":"CONFIRM RECHARGE"})]})})]})})})]})};export{re as default};
