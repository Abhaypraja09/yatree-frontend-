import{b as i,j as e,T as u,O as J,C as U,Q as M,x as G,_ as I,M as z,J as k,m as A,V as Q,s as X,Z as Y,H as Z}from"./vendor-CCQY6jT8.js";import{b as K,i as c}from"./index-DswTxbm0.js";import{S as ee}from"./SEO-CjuU2MAi.js";const re=()=>{const{selectedCompany:l}=K(),[R,L]=i.useState([]),[j,D]=i.useState([]),[T,W]=i.useState([]),[B,v]=i.useState(!0),[_,p]=i.useState(!1),[x,P]=i.useState(""),[b,te]=i.useState("All"),[h,F]=i.useState("All"),[f,g]=i.useState(null),[a,n]=i.useState({vehicleId:"",driverId:"",date:new Date().toISOString().split("T")[0],location:"",description:"",amount:"",status:"Pending"}),[E,y]=i.useState([]),[w,N]=i.useState(!1);i.useEffect(()=>{l&&(m(),O())},[l]);const m=async()=>{if(l?._id){v(!0);try{const t=JSON.parse(localStorage.getItem("userInfo")),{data:s}=await c.get(`/api/admin/accident-logs/${l._id}`,{headers:{Authorization:`Bearer ${t.token}`}});L(s||[])}catch(t){console.error(t)}finally{v(!1)}}},O=async()=>{if(l?._id)try{const t=JSON.parse(localStorage.getItem("userInfo")),[s,r]=await Promise.all([c.get(`/api/admin/vehicles/${l._id}?usePagination=false&type=all`,{headers:{Authorization:`Bearer ${t.token}`}}),c.get(`/api/admin/drivers/${l._id}?usePagination=false`,{headers:{Authorization:`Bearer ${t.token}`}})]);D(s.data.vehicles||[]),W(r.data.drivers||[])}catch(t){console.error(t)}},V=async t=>{t.preventDefault(),N(!0);try{const s=new FormData;Object.keys(a).forEach(o=>s.append(o,a[o])),s.append("companyId",l._id),Array.from(E).forEach(o=>{s.append("photos",o)});const r=JSON.parse(localStorage.getItem("userInfo"));await c.post("/api/admin/accident-logs",s,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${r.token}`}}),p(!1),$(),m(),alert("Incident report logged successfully")}catch(s){console.error(s),alert("Failed to log incident")}finally{N(!1)}},S=async t=>{if(window.confirm("Are you sure you want to delete this log?"))try{const s=JSON.parse(localStorage.getItem("userInfo"));await c.delete(`/api/admin/accident-logs/${t}`,{headers:{Authorization:`Bearer ${s.token}`}}),m()}catch(s){console.error(s)}},$=()=>{n({vehicleId:"",driverId:"",date:new Date().toISOString().split("T")[0],location:"",description:"",amount:"",status:"Pending"}),y([])},d=R.filter(t=>{const s=t.vehicle?.carNumber?.toLowerCase().includes(x.toLowerCase())||t.driver?.name?.toLowerCase().includes(x.toLowerCase())||t.description?.toLowerCase().includes(x.toLowerCase()),r=b==="All"||t.status===b,o=h==="All"||t.vehicle?._id===h;return s&&r&&o}),H=d.reduce((t,s)=>t+(Number(s.amount)||0),0),q=d.filter(t=>t.status==="Resolved").length,C=({status:t})=>e.jsx("span",{style:{fontSize:"10px",backgroundColor:t==="Resolved"?"rgba(16, 185, 129, 0.1)":"rgba(245, 158, 11, 0.1)",color:t==="Resolved"?"#10b981":"#f59e0b",padding:"4px 8px",borderRadius:"6px",fontWeight:"800",textTransform:"uppercase",whiteSpace:"nowrap"},children:t});return e.jsxs("div",{className:"container-fluid",style:{paddingBottom:"40px"},children:[e.jsx(ee,{title:"Active Accident Logs",description:"Track and manage vehicle accidents and incidents."}),e.jsxs("header",{className:"flex-resp",style:{justifyContent:"space-between",padding:"30px 0",gap:"20px",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx("div",{style:{width:"clamp(40px,10vw,50px)",height:"clamp(40px,10vw,50px)",background:"linear-gradient(135deg, white, #f8fafc)",borderRadius:"16px",padding:"8px",display:"flex",justifyContent:"center",alignItems:"center",boxShadow:"0 10px 25px rgba(0,0,0,0.2)"},children:e.jsx(u,{size:28,color:"#fbbf24"})}),e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"4px"},children:[e.jsx("div",{style:{width:"6px",height:"6px",borderRadius:"50%",background:"#fbbf24",boxShadow:"0 0 8px #fbbf24"}}),e.jsx("span",{style:{fontSize:"clamp(9px,2.5vw,10px)",fontWeight:"800",color:"rgba(255,255,255,0.5)",letterSpacing:"1px",textTransform:"uppercase"},children:"Fleet Safety"})]}),e.jsxs("h1",{style:{color:"white",fontSize:"clamp(24px, 5vw, 32px)",fontWeight:"900",margin:0,letterSpacing:"-1px",cursor:"pointer"},children:["Incident ",e.jsx("span",{className:"text-gradient-yellow",children:"Logs"})]})]})]}),e.jsxs("div",{className:"flex-resp",style:{gap:"15px",flex:"1",justifyContent:"flex-end",flexWrap:"wrap"},children:[e.jsxs("div",{className:"glass-card",style:{padding:"0",display:"flex",alignItems:"center",width:"100%",maxWidth:"300px",borderRadius:"14px",border:"1px solid rgba(255,255,255,0.08)",flex:1},children:[e.jsx(J,{size:18,style:{margin:"0 15px",color:"rgba(255,255,255,0.4)"}}),e.jsx("input",{type:"text",placeholder:"Search incidents...",value:x,onChange:t=>P(t.target.value),style:{background:"transparent",border:"none",color:"white",height:"50px",width:"100%",outline:"none",fontSize:"14px"}})]}),e.jsxs("div",{className:"glass-card",style:{padding:"0 15px",display:"flex",alignItems:"center",height:"50px",borderRadius:"14px",border:"1px solid rgba(255,255,255,0.08)",flex:"0 1 auto"},children:[e.jsx(U,{size:18,style:{marginRight:"10px",color:"var(--primary)"}}),e.jsxs("select",{value:h,onChange:t=>F(t.target.value),style:{background:"transparent",border:"none",color:"white",outline:"none",fontSize:"13px",fontWeight:"700",cursor:"pointer",maxWidth:"150px"},children:[e.jsx("option",{value:"All",children:"All Vehicles"}),j.map(t=>e.jsx("option",{value:t._id,style:{background:"#1e293b"},children:t.carNumber},t._id))]})]}),e.jsxs("button",{className:"btn-primary",onClick:()=>p(!0),style:{display:"flex",alignItems:"center",gap:"10px",height:"52px",padding:"0 25px",borderRadius:"14px",fontWeight:"800",background:"rgba(244, 63, 94, 0.15)",color:"#f43f5e",border:"1px solid rgba(244, 63, 94, 0.2)",whiteSpace:"nowrap"},children:[e.jsx(M,{size:20})," ",e.jsx("span",{className:"hide-mobile",children:"New Incident"}),e.jsx("span",{className:"show-mobile",children:"Add"})]})]})]}),e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"glass-card stat-card",style:{background:"rgba(244, 63, 94, 0.05)",borderColor:"rgba(244, 63, 94, 0.1)"},children:[e.jsxs("div",{className:"stat-card-header",children:[e.jsx("div",{className:"stat-card-icon",style:{background:"rgba(244, 63, 94, 0.1)",color:"#f43f5e"},children:e.jsx(u,{size:18})}),e.jsx("p",{className:"stat-card-label",children:"Total Incidents"})]}),e.jsx("h2",{className:"stat-card-value",children:d.length})]}),e.jsxs("div",{className:"glass-card stat-card",style:{background:"rgba(245, 158, 11, 0.05)",borderColor:"rgba(245, 158, 11, 0.1)"},children:[e.jsxs("div",{className:"stat-card-header",children:[e.jsx("div",{className:"stat-card-icon",style:{background:"rgba(245, 158, 11, 0.1)",color:"#f59e0b"},children:e.jsx(G,{size:18})}),e.jsx("p",{className:"stat-card-label",children:"Est. Cost"})]}),e.jsxs("h2",{className:"stat-card-value",children:["₹",H.toLocaleString()]})]}),e.jsxs("div",{className:"glass-card stat-card",style:{background:"rgba(16, 185, 129, 0.05)",borderColor:"rgba(16, 185, 129, 0.1)"},children:[e.jsxs("div",{className:"stat-card-header",children:[e.jsx("div",{className:"stat-card-icon",style:{background:"rgba(16, 185, 129, 0.1)",color:"#10b981"},children:e.jsx(I,{size:18})}),e.jsx("p",{className:"stat-card-label",children:"Resolved"})]}),e.jsx("h2",{className:"stat-card-value",children:q})]})]}),B?e.jsxs("div",{style:{padding:"80px",textAlign:"center"},children:[e.jsx("div",{className:"spinner",style:{margin:"0 auto"}}),e.jsx("p",{style:{color:"var(--text-muted)",marginTop:"20px",fontSize:"14px"},children:"Loading logs..."})]}):d.length===0?e.jsxs("div",{className:"glass-card",style:{padding:"60px",textAlign:"center"},children:[e.jsx(u,{size:48,style:{color:"rgba(255,255,255,0.1)",marginBottom:"20px"}}),e.jsx("h3",{style:{color:"white"},children:"No incidents recorded"}),e.jsx("p",{style:{color:"var(--text-muted)"},children:'Use the "New Incident" button to log vehicle damage.'})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"glass-card hide-mobile",style:{padding:0,overflow:"hidden"},children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"activity-table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date & Loc"}),e.jsx("th",{children:"Vehicle / Driver"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Est. Cost"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Evidence"}),e.jsx("th",{style:{textAlign:"right"},children:"Action"})]})}),e.jsx("tbody",{children:d.map(t=>e.jsxs("tr",{className:"hover-row",children:[e.jsxs("td",{children:[e.jsx("div",{style:{color:"white",fontWeight:"700",fontSize:"13px"},children:new Date(t.date).toLocaleDateString("en-GB")}),e.jsxs("div",{style:{color:"var(--text-muted)",fontSize:"11px",marginTop:"4px",display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(z,{size:10})," ",t.location||"Unknown"]})]}),e.jsxs("td",{children:[e.jsx("div",{className:"vehicle-badge",style:{marginBottom:"4px"},children:t.vehicle?.carNumber||"Unknown"}),e.jsx("div",{style:{color:"var(--text-muted)",fontSize:"11px"},children:t.driver?.name})]}),e.jsx("td",{style:{maxWidth:"300px"},children:e.jsx("div",{style:{color:"white",fontSize:"13px",lineHeight:"1.4",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:t.description})}),e.jsx("td",{children:e.jsxs("div",{style:{color:"#f43f5e",fontWeight:"800"},children:["₹",Number(t.amount||0).toLocaleString()]})}),e.jsx("td",{children:e.jsx(C,{status:t.status})}),e.jsx("td",{children:t.photos&&t.photos.length>0?e.jsxs("div",{style:{display:"flex",gap:"6px"},children:[t.photos.slice(0,3).map((s,r)=>e.jsx("div",{className:"img-overlay",style:{position:"relative",cursor:"zoom-in",transition:"0.2s"},children:e.jsx("img",{src:s,onClick:()=>g(s),style:{width:"32px",height:"32px",borderRadius:"6px",objectFit:"cover",border:"1px solid rgba(255,255,255,0.1)"}})},r)),t.photos.length>3&&e.jsxs("div",{style:{width:"32px",height:"32px",borderRadius:"6px",background:"rgba(255,255,255,0.1)",display:"flex",justifyContent:"center",alignItems:"center",fontSize:"10px",color:"white",fontWeight:"700"},children:["+",t.photos.length-3]})]}):e.jsx("span",{style:{color:"rgba(255,255,255,0.2)",fontSize:"11px"},children:"No img"})}),e.jsx("td",{style:{textAlign:"right"},children:e.jsx("button",{onClick:()=>S(t._id),className:"action-button",style:{background:"rgba(244, 63, 94, 0.1)",color:"#f43f5e",border:"1px solid rgba(244, 63, 94, 0.2)",padding:"6px 10px"},children:e.jsx(k,{size:14})})})]},t._id))})]})})}),e.jsx("div",{className:"show-mobile",children:e.jsx("div",{style:{display:"grid",gap:"15px"},children:d.map(t=>e.jsxs(A.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"glass-card",style:{padding:"15px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"12px"},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"6px"},children:[e.jsx("span",{className:"vehicle-badge",style:{fontSize:"12px"},children:t.vehicle?.carNumber||"N/A"}),e.jsx(C,{status:t.status})]}),e.jsxs("div",{style:{color:"var(--text-muted)",fontSize:"12px",display:"flex",alignItems:"center",gap:"5px"},children:[e.jsx(Q,{size:12})," ",t.driver?.name||"Unknown"]})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsxs("div",{style:{color:"#f43f5e",fontWeight:"800",fontSize:"16px"},children:["₹",Number(t.amount||0).toLocaleString()]}),e.jsx("div",{style:{fontSize:"10px",color:"var(--text-muted)",marginTop:"2px"},children:new Date(t.date).toLocaleDateString("en-GB")})]})]}),e.jsxs("div",{style:{background:"rgba(0,0,0,0.2)",padding:"12px",borderRadius:"10px",marginBottom:"12px"},children:[e.jsx("p",{style:{color:"var(--text-muted)",fontSize:"10px",fontWeight:"800",textTransform:"uppercase",marginBottom:"4px"},children:"Description"}),e.jsx("p",{style:{color:"white",fontSize:"13px",lineHeight:"1.4",margin:0},children:t.description}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px",marginTop:"8px",fontSize:"11px",color:"var(--primary)"},children:[e.jsx(z,{size:12})," ",t.location||"Location not tagged"]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"10px"},children:[e.jsx("div",{style:{display:"flex",gap:"5px"},children:t.photos&&t.photos.map((s,r)=>e.jsx("img",{src:s,onClick:()=>g(s),style:{width:"40px",height:"40px",borderRadius:"8px",objectFit:"cover",border:"1px solid rgba(255,255,255,0.1)"}},r))}),e.jsx("button",{onClick:()=>S(t._id),style:{background:"rgba(244, 63, 94, 0.1)",color:"#f43f5e",width:"32px",height:"32px",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(k,{size:16})})]})]},t._id))})})]}),e.jsx(X,{children:_&&e.jsx("div",{style:{position:"fixed",inset:0,zIndex:2e3,background:"rgba(0,0,0,0.85)",backdropFilter:"blur(5px)",display:"flex",justifyContent:"center",alignItems:"center",padding:"20px"},children:e.jsxs(A.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"glass-card modal-content",style:{maxWidth:"600px",width:"100%",maxHeight:"90vh",overflowY:"auto"},children:[e.jsxs("div",{className:"modal-header",style:{marginBottom:"20px"},children:[e.jsx("h2",{className:"modal-title",children:"Log New Incident"}),e.jsx("button",{onClick:()=>p(!1),className:"modal-close-btn",children:e.jsx(Y,{size:20})})]}),e.jsx("form",{onSubmit:V,children:e.jsxs("div",{style:{display:"grid",gap:"20px"},children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Vehicle Involved"}),e.jsxs("select",{className:"input-field",value:a.vehicleId,onChange:t=>n({...a,vehicleId:t.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"-- Select Vehicle --"}),j.map(t=>e.jsxs("option",{value:t._id,children:[t.carNumber," (",t.model,")"]},t._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Driver"}),e.jsxs("select",{className:"input-field",value:a.driverId,onChange:t=>n({...a,driverId:t.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"-- Select Driver --"}),T.map(t=>e.jsxs("option",{value:t._id,children:[t.name," (",t.mobile,")"]},t._id))]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"15px"},children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Date"}),e.jsx("input",{type:"date",className:"input-field",value:a.date,onChange:t=>n({...a,date:t.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Est. Cost"}),e.jsx("input",{type:"number",className:"input-field",value:a.amount,onChange:t=>n({...a,amount:t.target.value}),placeholder:"0.00"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Location"}),e.jsx("input",{type:"text",className:"input-field",value:a.location,onChange:t=>n({...a,location:t.target.value}),placeholder:"e.g. Highway 44",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Description"}),e.jsx("textarea",{className:"input-field",style:{minHeight:"80px",resize:"vertical"},value:a.description,onChange:t=>n({...a,description:t.target.value}),placeholder:"Describe damage details...",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Evidence Photos"}),e.jsxs("div",{style:{position:"relative",overflow:"hidden"},children:[e.jsx("input",{type:"file",multiple:!0,onChange:t=>y(t.target.files),className:"input-field",style:{paddingTop:"10px"}}),e.jsx(Z,{size:18,style:{position:"absolute",right:"15px",top:"15px",color:"var(--text-muted)"}})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Current Status"}),e.jsxs("select",{className:"input-field",value:a.status,onChange:t=>n({...a,status:t.target.value}),children:[e.jsx("option",{value:"Pending",children:"Pending Review"}),e.jsx("option",{value:"In Repair",children:"In Repair"}),e.jsx("option",{value:"Resolved",children:"Resolved / Closed"})]})]}),e.jsx("button",{type:"submit",disabled:w,className:"btn-primary",style:{width:"100%",display:"flex",justifyContent:"center",alignItems:"center",gap:"10px",height:"50px",marginTop:"10px"},children:w?"Processing...":e.jsxs(e.Fragment,{children:[e.jsx(I,{size:18})," Submit Incident Report"]})})]})})]})})}),f&&e.jsx("div",{onClick:()=>g(null),style:{position:"fixed",inset:0,zIndex:3e3,background:"rgba(0,0,0,0.95)",backdropFilter:"blur(5px)",display:"flex",justifyContent:"center",alignItems:"center",cursor:"zoom-out",padding:"20px"},children:e.jsx("img",{src:f,style:{maxWidth:"100%",maxHeight:"90vh",borderRadius:"12px",boxShadow:"0 20px 50px rgba(0,0,0,0.5)"}})})]})};export{re as default};
