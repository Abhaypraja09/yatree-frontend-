import{b as s,j as e,f as R,m as L,w as v,Z as O,a2 as k,M as w,a3 as D,p as E}from"./vendor-BXfTzn-0.js";import{u as W,i as g}from"./index-C6MgHkp-.js";import{S as B}from"./SEO-Dbf0-trz.js";const G=()=>{const{user:h,logout:I}=W(),[n,z]=s.useState(null),[u,C]=s.useState([]),[P,m]=s.useState(!0),[r,c]=s.useState(!1),[f,T]=s.useState(new Date);s.useEffect(()=>{y(),j();const t=setInterval(()=>T(new Date),1e3);return()=>clearInterval(t)},[]);const y=async()=>{try{const{data:t}=await g.get("/api/staff/status");z(t.staff?t:null)}catch(t){console.error("Error fetching status:",t)}},j=async()=>{try{const{data:t}=await g.get("/api/staff/history");C(t),m(!1)}catch(t){console.error("Error fetching history:",t),m(!1)}},S=async t=>{c(!0);try{if(!navigator.geolocation){alert("Geolocation is not supported by your browser or device.");return}if(window.location.protocol!=="https:"&&window.location.hostname!=="localhost"&&window.location.hostname!=="127.0.0.1"){alert("CRITICAL ERROR: Browser blocks location on insecure connections. Please use https://."),c(!1);return}const o=await new Promise((p,a)=>{const b=setTimeout(()=>{a({code:3,message:"Position acquisition timed out."})},15e3);navigator.geolocation.getCurrentPosition(x=>{clearTimeout(b),p(x)},x=>{clearTimeout(b),a(x)},{enableHighAccuracy:!0,timeout:12e3,maximumAge:0})}),{latitude:i,longitude:l,accuracy:N}=o.coords;let d=`Lat: ${i.toFixed(6)}, Lng: ${l.toFixed(6)}`;try{const a=await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${i}&lon=${l}&zoom=18&addressdetails=1`)).json();a.display_name&&(d=a.display_name)}catch{d=`Coordinates: ${i.toFixed(6)}, ${l.toFixed(6)} (Acc: ${Math.round(N)}m)`}const A=t==="in"?"/api/staff/punch-in":"/api/staff/punch-out";await g.post(A,{latitude:i,longitude:l,address:d}),y(),j()}catch(o){let i="Error fetching location.";o.code===1?i='PERMISSION_DENIED: Please click "Allow" for location.':o.code===2?i="POSITION_UNAVAILABLE: GPS signal not found.":o.code===3&&(i="TIMEOUT: Failed to get location quickly."),alert(i)}finally{c(!1)}};return P?e.jsx("div",{style:{color:"white",padding:"100px",textAlign:"center"},children:"Loading Portal..."}):e.jsxs("div",{style:{minHeight:"100vh",background:"radial-gradient(circle at top right, #1e293b, #0f172a)",padding:"20px",color:"white"},children:[e.jsx(B,{title:"Staff Portal"}),e.jsxs("div",{style:{maxWidth:"600px",margin:"0 auto",display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"30px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("div",{style:{width:"45px",height:"45px",borderRadius:"12px",background:"linear-gradient(135deg, #0ea5e9, #6366f1)",display:"flex",justifyContent:"center",alignItems:"center",fontWeight:"800"},children:h.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("h2",{style:{fontSize:"18px",margin:0},children:h.name}),e.jsx("p",{style:{fontSize:"12px",color:"var(--text-muted)",margin:0},children:"Staff Portal"})]})]}),e.jsxs("button",{onClick:I,style:{background:"rgba(244, 63, 94, 0.1)",border:"1px solid rgba(244, 63, 94, 0.2)",color:"#f43f5e",padding:"8px 15px",borderRadius:"10px",fontSize:"12px",fontWeight:"800",display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(R,{size:16})," Logout"]})]}),e.jsxs("div",{style:{maxWidth:"600px",margin:"0 auto"},children:[e.jsxs(L.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"glass-card",style:{padding:"40px 20px",textAlign:"center",marginBottom:"30px",position:"relative",overflow:"hidden"},children:[e.jsx("p",{style:{fontSize:"14px",color:"var(--text-muted)",marginBottom:"10px",fontWeight:"700",textTransform:"uppercase"},children:f.toLocaleDateString("en-IN",{weekday:"long",day:"numeric",month:"long"})}),e.jsx("h1",{style:{fontSize:"48px",fontWeight:"900",margin:"0 0 40px 0"},children:f.toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit",second:"2-digit"})}),n?n.punchOut?.time?e.jsxs("div",{style:{padding:"30px",background:"rgba(16, 185, 129, 0.1)",borderRadius:"20px",border:"1px solid rgba(16, 185, 129, 0.2)"},children:[e.jsx(O,{size:60,color:"#10b981",style:{margin:"0 auto 20px auto"}}),e.jsx("h2",{style:{color:"#10b981",margin:"0 0 5px 0"},children:"Duty Completed"}),e.jsx("p",{style:{color:"var(--text-muted)",fontSize:"14px"},children:"Successfully punched out for today."})]}):e.jsx("button",{disabled:r,onClick:()=>S("out"),style:{width:"200px",height:"200px",borderRadius:"50%",fontSize:"24px",fontWeight:"900",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",gap:"10px",margin:"0 auto",background:"linear-gradient(135deg, #f43f5e, #e11d48)",color:"white"},children:r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"spinner",style:{width:"40px",height:"40px",borderColor:"white",borderTopColor:"transparent"}}),e.jsx("span",{style:{fontSize:"12px"},children:"CAPTURING GPS..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(v,{size:48}),"PUNCH OUT"]})}):e.jsx("button",{disabled:r,onClick:()=>S("in"),className:"btn-primary",style:{width:"200px",height:"200px",borderRadius:"50%",fontSize:"24px",fontWeight:"900",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",gap:"10px",margin:"0 auto"},children:r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"spinner",style:{width:"40px",height:"40px"}}),e.jsx("span",{style:{fontSize:"12px"},children:"CAPTURING GPS..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(v,{size:48}),"PUNCH IN"]})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"15px",marginBottom:"30px"},children:[e.jsxs("div",{className:"glass-card",style:{padding:"20px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"15px"},children:[e.jsx(k,{color:"#10b981",size:20}),e.jsx("span",{style:{fontSize:"10px",fontWeight:"800",color:"var(--text-muted)",textTransform:"uppercase"},children:"Punch In"})]}),e.jsx("h2",{style:{margin:0,fontSize:"24px"},children:n?.punchIn?.time?new Date(n.punchIn.time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"--:--"}),e.jsxs("p",{style:{fontSize:"12px",color:"var(--text-muted)",marginTop:"8px"},children:[e.jsx(w,{size:12})," ",n?.punchIn?.location?.address?.split(",")[0]||"Pending"]})]}),e.jsxs("div",{className:"glass-card",style:{padding:"20px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"15px"},children:[e.jsx(D,{color:"#f43f5e",size:20}),e.jsx("span",{style:{fontSize:"10px",fontWeight:"800",color:"var(--text-muted)",textTransform:"uppercase"},children:"Punch Out"})]}),e.jsx("h2",{style:{margin:0,fontSize:"24px"},children:n?.punchOut?.time?new Date(n.punchOut.time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"--:--"}),e.jsxs("p",{style:{fontSize:"12px",color:"var(--text-muted)",marginTop:"8px"},children:[e.jsx(w,{size:12})," ",n?.punchOut?.location?.address?.split(",")[0]||"Pending"]})]})]}),e.jsxs("div",{className:"glass-card",style:{padding:"20px"},children:[e.jsx("h3",{style:{margin:"0 0 20px 0",fontSize:"16px",fontWeight:"800",borderBottom:"1px solid rgba(255,255,255,0.05)",paddingBottom:"15px"},children:"Recent Attendance"}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:u.length===0?e.jsx("p",{style:{color:"var(--text-muted)",fontSize:"12px",textAlign:"center"},children:"No history found."}):u.slice(0,7).map(t=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px",background:"rgba(255,255,255,0.02)",borderRadius:"10px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(E,{size:14,color:"var(--primary)"}),e.jsx("span",{style:{fontSize:"14px",fontWeight:"700"},children:t.date})]}),e.jsxs("div",{style:{display:"flex",gap:"15px"},children:[e.jsxs("div",{style:{color:"#10b981",fontSize:"12px",fontWeight:"800"},children:["IN: ",new Date(t.punchIn.time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}),e.jsxs("div",{style:{color:"#f43f5e",fontSize:"12px",fontWeight:"800"},children:["OUT: ",t.punchOut?.time?new Date(t.punchOut.time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"--:--"]})]})]},t._id))})]})]})]})};export{G as default};
