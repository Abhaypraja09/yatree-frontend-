import{b as i,j as e,K as U,C as J,O as M,T as C,w as G,Z as I,M as z,H as k,m as A,Q as Y,A as K,Y as Q,x as X}from"./vendor-BXfTzn-0.js";import{b as Z,i as c}from"./index-CTxDrFbq.js";import{S as ee}from"./SEO-GJK5pBVT.js";const re=()=>{const{selectedCompany:l}=Z(),[L,R]=i.useState([]),[g,D]=i.useState([]),[T,B]=i.useState([]),[W,j]=i.useState(!0),[_,p]=i.useState(!1),[x,P]=i.useState(""),[v,se]=i.useState("All"),[h,E]=i.useState("All"),[b,m]=i.useState(null),[a,n]=i.useState({vehicleId:"",driverId:"",date:new Date().toISOString().split("T")[0],location:"",description:"",amount:"",status:"Pending"}),[F,y]=i.useState([]),[f,N]=i.useState(!1);i.useEffect(()=>{l&&(u(),O())},[l]);const u=async()=>{if(l?._id){j(!0);try{const s=JSON.parse(localStorage.getItem("userInfo")),{data:t}=await c.get(`/api/admin/accident-logs/${l._id}`,{headers:{Authorization:`Bearer ${s.token}`}});R(t||[])}catch(s){console.error(s)}finally{j(!1)}}},O=async()=>{if(l?._id)try{const s=JSON.parse(localStorage.getItem("userInfo")),[t,r]=await Promise.all([c.get(`/api/admin/vehicles/${l._id}?usePagination=false&type=all`,{headers:{Authorization:`Bearer ${s.token}`}}),c.get(`/api/admin/drivers/${l._id}?usePagination=false`,{headers:{Authorization:`Bearer ${s.token}`}})]);D(t.data.vehicles||[]),B(r.data.drivers||[])}catch(s){console.error(s)}},V=async s=>{s.preventDefault(),N(!0);try{const t=new FormData;Object.keys(a).forEach(o=>t.append(o,a[o])),t.append("companyId",l._id),Array.from(F).forEach(o=>{t.append("photos",o)});const r=JSON.parse(localStorage.getItem("userInfo"));await c.post("/api/admin/accident-logs",t,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${r.token}`}}),p(!1),$(),u(),alert("Incident report logged successfully")}catch(t){console.error(t),alert("Failed to log incident")}finally{N(!1)}},S=async s=>{if(window.confirm("Are you sure you want to delete this log?"))try{const t=JSON.parse(localStorage.getItem("userInfo"));await c.delete(`/api/admin/accident-logs/${s}`,{headers:{Authorization:`Bearer ${t.token}`}}),u()}catch(t){console.error(t)}},$=()=>{n({vehicleId:"",driverId:"",date:new Date().toISOString().split("T")[0],location:"",description:"",amount:"",status:"Pending"}),y([])},d=L.filter(s=>{const t=s.vehicle?.carNumber?.toLowerCase().includes(x.toLowerCase())||s.driver?.name?.toLowerCase().includes(x.toLowerCase())||s.description?.toLowerCase().includes(x.toLowerCase()),r=v==="All"||s.status===v,o=h==="All"||s.vehicle?._id===h;return t&&r&&o}),H=d.reduce((s,t)=>s+(Number(t.amount)||0),0),q=d.filter(s=>s.status==="Resolved").length,w=({status:s})=>e.jsx("span",{style:{fontSize:"10px",backgroundColor:s==="Resolved"?"rgba(16, 185, 129, 0.1)":"rgba(245, 158, 11, 0.1)",color:s==="Resolved"?"#10b981":"#f59e0b",padding:"4px 8px",borderRadius:"6px",fontWeight:"800",textTransform:"uppercase",whiteSpace:"nowrap"},children:s});return e.jsxs("div",{className:"container-fluid",style:{paddingBottom:"40px"},children:[e.jsx(ee,{title:"Active Accident Logs",description:"Track and manage vehicle accidents and incidents."}),e.jsxs("header",{className:"flex-resp",style:{justifyContent:"space-between",padding:"30px 0",gap:"20px",flexWrap:"wrap"},children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"resp-title",style:{color:"white",margin:0,letterSpacing:"-1px",fontSize:"clamp(24px, 5vw, 32px)"},children:["Incident ",e.jsx("span",{className:"text-gradient",children:"Logs"})]}),e.jsx("p",{className:"resp-subtitle",style:{marginTop:"5px"},children:"Track vehicle damage and on-road incidents."})]}),e.jsxs("div",{className:"flex-resp",style:{gap:"15px",flex:"1",justifyContent:"flex-end",flexWrap:"wrap"},children:[e.jsxs("div",{className:"glass-card",style:{padding:"0",display:"flex",alignItems:"center",width:"100%",maxWidth:"300px",borderRadius:"14px",border:"1px solid rgba(255,255,255,0.08)",flex:1},children:[e.jsx(U,{size:18,style:{margin:"0 15px",color:"rgba(255,255,255,0.4)"}}),e.jsx("input",{type:"text",placeholder:"Search incidents...",value:x,onChange:s=>P(s.target.value),style:{background:"transparent",border:"none",color:"white",height:"50px",width:"100%",outline:"none",fontSize:"14px"}})]}),e.jsxs("div",{className:"glass-card",style:{padding:"0 15px",display:"flex",alignItems:"center",height:"50px",borderRadius:"14px",border:"1px solid rgba(255,255,255,0.08)",flex:"0 1 auto"},children:[e.jsx(J,{size:18,style:{marginRight:"10px",color:"var(--primary)"}}),e.jsxs("select",{value:h,onChange:s=>E(s.target.value),style:{background:"transparent",border:"none",color:"white",outline:"none",fontSize:"13px",fontWeight:"700",cursor:"pointer",maxWidth:"150px"},children:[e.jsx("option",{value:"All",children:"All Vehicles"}),g.map(s=>e.jsx("option",{value:s._id,style:{background:"#1e293b"},children:s.carNumber},s._id))]})]}),e.jsxs("button",{className:"btn-primary",onClick:()=>p(!0),style:{display:"flex",alignItems:"center",gap:"10px",height:"52px",padding:"0 25px",borderRadius:"14px",fontWeight:"800",background:"rgba(244, 63, 94, 0.15)",color:"#f43f5e",border:"1px solid rgba(244, 63, 94, 0.2)",whiteSpace:"nowrap"},children:[e.jsx(M,{size:20})," ",e.jsx("span",{className:"hide-mobile",children:"New Incident"}),e.jsx("span",{className:"show-mobile",children:"Add"})]})]})]}),e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"glass-card stat-card",style:{background:"rgba(244, 63, 94, 0.05)",borderColor:"rgba(244, 63, 94, 0.1)"},children:[e.jsxs("div",{className:"stat-card-header",children:[e.jsx("div",{className:"stat-card-icon",style:{background:"rgba(244, 63, 94, 0.1)",color:"#f43f5e"},children:e.jsx(C,{size:18})}),e.jsx("p",{className:"stat-card-label",children:"Total Incidents"})]}),e.jsx("h2",{className:"stat-card-value",children:d.length})]}),e.jsxs("div",{className:"glass-card stat-card",style:{background:"rgba(245, 158, 11, 0.05)",borderColor:"rgba(245, 158, 11, 0.1)"},children:[e.jsxs("div",{className:"stat-card-header",children:[e.jsx("div",{className:"stat-card-icon",style:{background:"rgba(245, 158, 11, 0.1)",color:"#f59e0b"},children:e.jsx(G,{size:18})}),e.jsx("p",{className:"stat-card-label",children:"Est. Cost"})]}),e.jsxs("h2",{className:"stat-card-value",children:["₹",H.toLocaleString()]})]}),e.jsxs("div",{className:"glass-card stat-card",style:{background:"rgba(16, 185, 129, 0.05)",borderColor:"rgba(16, 185, 129, 0.1)"},children:[e.jsxs("div",{className:"stat-card-header",children:[e.jsx("div",{className:"stat-card-icon",style:{background:"rgba(16, 185, 129, 0.1)",color:"#10b981"},children:e.jsx(I,{size:18})}),e.jsx("p",{className:"stat-card-label",children:"Resolved"})]}),e.jsx("h2",{className:"stat-card-value",children:q})]})]}),W?e.jsxs("div",{style:{padding:"80px",textAlign:"center"},children:[e.jsx("div",{className:"spinner",style:{margin:"0 auto"}}),e.jsx("p",{style:{color:"var(--text-muted)",marginTop:"20px",fontSize:"14px"},children:"Loading logs..."})]}):d.length===0?e.jsxs("div",{className:"glass-card",style:{padding:"60px",textAlign:"center"},children:[e.jsx(C,{size:48,style:{color:"rgba(255,255,255,0.1)",marginBottom:"20px"}}),e.jsx("h3",{style:{color:"white"},children:"No incidents recorded"}),e.jsx("p",{style:{color:"var(--text-muted)"},children:'Use the "New Incident" button to log vehicle damage.'})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"glass-card hide-mobile",style:{padding:0,overflow:"hidden"},children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"activity-table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date & Loc"}),e.jsx("th",{children:"Vehicle / Driver"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Est. Cost"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Evidence"}),e.jsx("th",{style:{textAlign:"right"},children:"Action"})]})}),e.jsx("tbody",{children:d.map(s=>e.jsxs("tr",{className:"hover-row",children:[e.jsxs("td",{children:[e.jsx("div",{style:{color:"white",fontWeight:"700",fontSize:"13px"},children:new Date(s.date).toLocaleDateString("en-GB")}),e.jsxs("div",{style:{color:"var(--text-muted)",fontSize:"11px",marginTop:"4px",display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(z,{size:10})," ",s.location||"Unknown"]})]}),e.jsxs("td",{children:[e.jsx("div",{className:"vehicle-badge",style:{marginBottom:"4px"},children:s.vehicle?.carNumber||"Unknown"}),e.jsx("div",{style:{color:"var(--text-muted)",fontSize:"11px"},children:s.driver?.name})]}),e.jsx("td",{style:{maxWidth:"300px"},children:e.jsx("div",{style:{color:"white",fontSize:"13px",lineHeight:"1.4",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:s.description})}),e.jsx("td",{children:e.jsxs("div",{style:{color:"#f43f5e",fontWeight:"800"},children:["₹",Number(s.amount||0).toLocaleString()]})}),e.jsx("td",{children:e.jsx(w,{status:s.status})}),e.jsx("td",{children:s.photos&&s.photos.length>0?e.jsxs("div",{style:{display:"flex",gap:"6px"},children:[s.photos.slice(0,3).map((t,r)=>e.jsx("div",{className:"img-overlay",style:{position:"relative",cursor:"zoom-in",transition:"0.2s"},children:e.jsx("img",{src:t,onClick:()=>m(t),style:{width:"32px",height:"32px",borderRadius:"6px",objectFit:"cover",border:"1px solid rgba(255,255,255,0.1)"}})},r)),s.photos.length>3&&e.jsxs("div",{style:{width:"32px",height:"32px",borderRadius:"6px",background:"rgba(255,255,255,0.1)",display:"flex",justifyContent:"center",alignItems:"center",fontSize:"10px",color:"white",fontWeight:"700"},children:["+",s.photos.length-3]})]}):e.jsx("span",{style:{color:"rgba(255,255,255,0.2)",fontSize:"11px"},children:"No img"})}),e.jsx("td",{style:{textAlign:"right"},children:e.jsx("button",{onClick:()=>S(s._id),className:"action-button",style:{background:"rgba(244, 63, 94, 0.1)",color:"#f43f5e",border:"1px solid rgba(244, 63, 94, 0.2)",padding:"6px 10px"},children:e.jsx(k,{size:14})})})]},s._id))})]})})}),e.jsx("div",{className:"show-mobile",children:e.jsx("div",{style:{display:"grid",gap:"15px"},children:d.map(s=>e.jsxs(A.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"glass-card",style:{padding:"15px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"12px"},children:[e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"6px"},children:[e.jsx("span",{className:"vehicle-badge",style:{fontSize:"12px"},children:s.vehicle?.carNumber||"N/A"}),e.jsx(w,{status:s.status})]}),e.jsxs("div",{style:{color:"var(--text-muted)",fontSize:"12px",display:"flex",alignItems:"center",gap:"5px"},children:[e.jsx(Y,{size:12})," ",s.driver?.name||"Unknown"]})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsxs("div",{style:{color:"#f43f5e",fontWeight:"800",fontSize:"16px"},children:["₹",Number(s.amount||0).toLocaleString()]}),e.jsx("div",{style:{fontSize:"10px",color:"var(--text-muted)",marginTop:"2px"},children:new Date(s.date).toLocaleDateString("en-GB")})]})]}),e.jsxs("div",{style:{background:"rgba(0,0,0,0.2)",padding:"12px",borderRadius:"10px",marginBottom:"12px"},children:[e.jsx("p",{style:{color:"var(--text-muted)",fontSize:"10px",fontWeight:"800",textTransform:"uppercase",marginBottom:"4px"},children:"Description"}),e.jsx("p",{style:{color:"white",fontSize:"13px",lineHeight:"1.4",margin:0},children:s.description}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px",marginTop:"8px",fontSize:"11px",color:"var(--primary)"},children:[e.jsx(z,{size:12})," ",s.location||"Location not tagged"]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"10px"},children:[e.jsx("div",{style:{display:"flex",gap:"5px"},children:s.photos&&s.photos.map((t,r)=>e.jsx("img",{src:t,onClick:()=>m(t),style:{width:"40px",height:"40px",borderRadius:"8px",objectFit:"cover",border:"1px solid rgba(255,255,255,0.1)"}},r))}),e.jsx("button",{onClick:()=>S(s._id),style:{background:"rgba(244, 63, 94, 0.1)",color:"#f43f5e",width:"32px",height:"32px",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(k,{size:16})})]})]},s._id))})})]}),e.jsx(K,{children:_&&e.jsx("div",{style:{position:"fixed",inset:0,zIndex:2e3,background:"rgba(0,0,0,0.85)",backdropFilter:"blur(5px)",display:"flex",justifyContent:"center",alignItems:"center",padding:"20px"},children:e.jsxs(A.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"glass-card modal-content",style:{maxWidth:"600px",width:"100%",maxHeight:"90vh",overflowY:"auto"},children:[e.jsxs("div",{className:"modal-header",style:{marginBottom:"20px"},children:[e.jsx("h2",{className:"modal-title",children:"Log New Incident"}),e.jsx("button",{onClick:()=>p(!1),className:"modal-close-btn",children:e.jsx(Q,{size:20})})]}),e.jsx("form",{onSubmit:V,children:e.jsxs("div",{style:{display:"grid",gap:"20px"},children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Vehicle Involved"}),e.jsxs("select",{className:"input-field",value:a.vehicleId,onChange:s=>n({...a,vehicleId:s.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"-- Select Vehicle --"}),g.map(s=>e.jsxs("option",{value:s._id,children:[s.carNumber," (",s.model,")"]},s._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Driver"}),e.jsxs("select",{className:"input-field",value:a.driverId,onChange:s=>n({...a,driverId:s.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"-- Select Driver --"}),T.map(s=>e.jsxs("option",{value:s._id,children:[s.name," (",s.mobile,")"]},s._id))]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"15px"},children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Date"}),e.jsx("input",{type:"date",className:"input-field",value:a.date,onChange:s=>n({...a,date:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Est. Cost"}),e.jsx("input",{type:"number",className:"input-field",value:a.amount,onChange:s=>n({...a,amount:s.target.value}),placeholder:"0.00"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Location"}),e.jsx("input",{type:"text",className:"input-field",value:a.location,onChange:s=>n({...a,location:s.target.value}),placeholder:"e.g. Highway 44",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Description"}),e.jsx("textarea",{className:"input-field",style:{minHeight:"80px",resize:"vertical"},value:a.description,onChange:s=>n({...a,description:s.target.value}),placeholder:"Describe damage details...",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Evidence Photos"}),e.jsxs("div",{style:{position:"relative",overflow:"hidden"},children:[e.jsx("input",{type:"file",multiple:!0,onChange:s=>y(s.target.files),className:"input-field",style:{paddingTop:"10px"}}),e.jsx(X,{size:18,style:{position:"absolute",right:"15px",top:"15px",color:"var(--text-muted)"}})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Current Status"}),e.jsxs("select",{className:"input-field",value:a.status,onChange:s=>n({...a,status:s.target.value}),children:[e.jsx("option",{value:"Pending",children:"Pending Review"}),e.jsx("option",{value:"In Repair",children:"In Repair"}),e.jsx("option",{value:"Resolved",children:"Resolved / Closed"})]})]}),e.jsx("button",{type:"submit",disabled:f,className:"btn-primary",style:{width:"100%",display:"flex",justifyContent:"center",alignItems:"center",gap:"10px",height:"50px",marginTop:"10px"},children:f?"Processing...":e.jsxs(e.Fragment,{children:[e.jsx(I,{size:18})," Submit Incident Report"]})})]})})]})})}),b&&e.jsx("div",{onClick:()=>m(null),style:{position:"fixed",inset:0,zIndex:3e3,background:"rgba(0,0,0,0.95)",backdropFilter:"blur(5px)",display:"flex",justifyContent:"center",alignItems:"center",cursor:"zoom-out",padding:"20px"},children:e.jsx("img",{src:b,style:{maxWidth:"100%",maxHeight:"90vh",borderRadius:"12px",boxShadow:"0 20px 50px rgba(0,0,0,0.5)"}})})]})};export{re as default};
